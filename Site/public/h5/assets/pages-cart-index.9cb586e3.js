import{g as e,n as a,d as t,r as l,A as s,B as o,o as c,e as i,w as n,f as d,i as r,j as u,k as _,l as m,p as h,u as f,F as p,q as g,t as k,v as C,C as v,x as b}from"./index-61bca09a.js";import{_ as y}from"./uv-loading-page.a3cea9e4.js";import{_ as x,r as V}from"./uni-app.es.c541313a.js";import{_ as L,a as D}from"./uv-checkbox-group.4f4585e7.js";import{_ as j}from"./uv-number-box.15074e39.js";import{_ as w}from"./uv-empty.b267d039.js";import"./uv-icon.06d9cba4.js";const F=x({data:()=>({theme:"",themeColor:"",loading:!0,allChecked:!1,allCheckedValue:[],dataList:[],result:[],total:"0.00"}),onShow(){let a=r(),t=e(),l={goods_id:0,url:t[t.length-1].route,platform:a.globalData.systemInfo.uniPlatform,model:a.globalData.systemInfo.deviceModel};this.$apis.visit.add(l),this.initData()},methods:{async initData(){let e,a=r(),t=this;await t.$onLaunched,t.theme=a.globalData.theme,t.themeColor=a.globalData.themeColor,e=await t.$apis.cart.getList({size:100}),t.dataList=e.data,t.loading=!1},turnUrl(e="",s=1){e&&"#"!=e&&(1==s&&a({url:e}),2==s&&t({url:e}),3==s&&l({url:e}))},changeAmount(e){let a=this,t=a.dataList,l=e.value,s=e.name;a.$apis.cart.editData({amount:l,id:s}).then((e=>{if(0==e.code){for(var o=0;o<t.length;o++)t[o].id==s&&(t[o].amount=l);a.dataList=t;let e=0,c=a.result;for(o=0;o<t.length;o++)1==t[o].is_effective&&c.includes(t[o].id)&&(e+=t[o].price*t[o].amount);a.total=e.toFixed(2)}else console.log(e.msg)}))},checkedAll(){let e=this,a=[],t=e.dataList,l=0;if(e.allChecked=!e.allChecked,e.allChecked){let e=0;for(var s=0;s<t.length;s++)1==t[s].is_effective&&(l+=t[s].price*t[s].amount,a[e]=t[s].id,e+=1)}e.result=a,e.total=l.toFixed(2)},onChange(e){let a=this,t=a.dataList,l=0,s=e,o=0;for(var c=0;c<t.length;c++)1==t[c].is_effective&&(o+=1,s.includes(t[c].id)&&(l+=t[c].price*t[c].amount));o==s.length?(a.allCheckedValue=["all"],a.allChecked=!0):(a.allCheckedValue=[],a.allChecked=!1),a.result=s,a.total=l.toFixed(2)},onSubmit(){let e=this.result;e.length<1?s({title:"请选择商品",icon:"error"}):a({url:"/pages/order/index?cart_id="+e.join(",")})},onDelete(e=""){let a=this,t=a.result;if(""==e&&t.length<1)s({title:"请选择商品",icon:"error"});else{let l=t.length<1?e:t.join(",");o({title:"提示",content:"确认要删除吗？",success(e){e.confirm&&a.$apis.cart.deleteData({id:l}).then((e=>{0==e.code?(a.result=[],a.initData()):s({title:e.msg,icon:"none"})}))}})}}}},[["render",function(e,a,t,l,s,o){const r=V(C("uv-loading-page"),y),x=u,F=V(C("uv-checkbox"),L),U=b,A=V(C("uv-number-box"),j),$=V(C("uv-checkbox-group"),D),I=V(C("uv-empty"),w);return c(),i(x,{class:d(["content",s.theme])},{default:n((()=>[_(r,{loading:s.loading},null,8,["loading"]),s.loading?k("",!0):(c(),m(p,{key:0},[_(x,{class:"header"},{default:n((()=>[_(x,{class:"header_ctt"},{default:n((()=>[_(x,{class:"cart_top"},{default:n((()=>[_(x,{class:"cart_top_title"},{default:n((()=>[_(x,null,{default:n((()=>[h("购物车")])),_:1}),_(x,{class:"span"},{default:n((()=>[h("(共"+f(s.dataList.length)+"件宝贝)",1)])),_:1})])),_:1}),_(x,{class:"cart_top_del",onClick:a[0]||(a[0]=e=>o.onDelete())},{default:n((()=>[h("删除")])),_:1})])),_:1})])),_:1})])),_:1}),_(x,{class:"wrap"},{default:n((()=>[_(x,{class:"space_header"}),_(x,{class:"m_ctr"},{default:n((()=>[_($,{modelValue:s.result,"onUpdate:modelValue":a[1]||(a[1]=e=>s.result=e),placement:"column",onChange:o.onChange},{default:n((()=>[(c(!0),m(p,null,g(s.dataList,((e,a)=>(c(),i(x,{class:"yuan_ctr",key:a},{default:n((()=>[_(x,{class:"cart_goods_ctr"},{default:n((()=>[_(x,{class:"cart_goods_checkbox"},{default:n((()=>[1==e.is_effective?(c(),i(F,{key:0,name:e.id,activeColor:s.themeColor,shape:"circle"},null,8,["name","activeColor"])):(c(),i(F,{key:1,name:e.id,disabled:!0,activeColor:s.themeColor,shape:"circle"},null,8,["name","activeColor"]))])),_:2},1024),_(x,{class:"cart_goods_pic",onClick:a=>o.turnUrl("/pages/goods/detail?id="+e.goods_id)},{default:n((()=>[_(U,{mode:"widthFix",src:e.pic},null,8,["src"])])),_:2},1032,["onClick"]),_(x,{class:"cart_goods_ctt"},{default:n((()=>[_(x,{class:"cart_goods_title",style:v(""==e.spec_key_name?"-webkit-line-clamp:2;":"")},{default:n((()=>[h(f(e.title),1)])),_:2},1032,["style"]),""!=e.spec_key_name?(c(),i(x,{key:0,class:"cart_goods_subtitle"},{default:n((()=>[h(f(e.spec_key_name),1)])),_:2},1024)):k("",!0),_(x,{class:"cart_goods_price"},{default:n((()=>[h("¥"+f(e.price),1)])),_:2},1024),1==e.is_effective?(c(),i(x,{key:1,class:"cart_amount_ctr"},{default:n((()=>[_(A,{modelValue:e.amount,"onUpdate:modelValue":a=>e.amount=a,name:e.id,min:1,max:e.stock,buttonSize:"44rpx",inputWidth:"60rpx",integer:"",onChange:o.changeAmount},null,8,["modelValue","onUpdate:modelValue","name","max","onChange"])])),_:2},1024)):(c(),i(x,{key:2,class:"cart_amount_ctr",style:{bottom:"16rpx"}},{default:n((()=>[_(x,null,{default:n((()=>[h("已失效")])),_:1}),_(x,{class:"del_btn",onClick:a=>o.onDelete(e.id)},{default:n((()=>[h("删除")])),_:2},1032,["onClick"])])),_:2},1024))])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["modelValue","onChange"]),s.dataList.length<1?(c(),i(x,{key:0,class:"none_ctr"},{default:n((()=>[_(I,{icon:"/static/images/none.png",text:"暂无商品"})])),_:1})):k("",!0)])),_:1}),_(x,{class:"space_footer"})])),_:1}),s.dataList.length>0?(c(),i(x,{key:0,class:"cart_footer"},{default:n((()=>[_(x,{class:"footer_ctt"},{default:n((()=>[_(x,{class:"cart_left"},{default:n((()=>[_($,{modelValue:s.allCheckedValue,"onUpdate:modelValue":a[2]||(a[2]=e=>s.allCheckedValue=e),onChange:o.checkedAll},{default:n((()=>[_(F,{shape:"circle",activeColor:s.themeColor,name:"all",label:"全选"},null,8,["activeColor"])])),_:1},8,["modelValue","onChange"])])),_:1}),_(x,{class:"cart_price"},{default:n((()=>[_(x,{class:"price_title"},{default:n((()=>[h("合计：")])),_:1}),_(x,{class:"price_fh"},{default:n((()=>[h("¥")])),_:1}),_(x,{class:"price"},{default:n((()=>[h(f(s.total),1)])),_:1})])),_:1}),_(x,{class:"cart_btn",onClick:o.onSubmit},{default:n((()=>[h("立即结算")])),_:1},8,["onClick"])])),_:1})])),_:1})):k("",!0)],64))])),_:1},8,["class"])}],["__scopeId","data-v-a8934543"]]);export{F as default};
