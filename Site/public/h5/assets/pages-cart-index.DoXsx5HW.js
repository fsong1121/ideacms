import{g as e,n as a,d as t,r as l,A as s,B as o,e as c,f as i,w as n,i as d,j as r,k as u,o as _,l as m,p as h,q as f,v as p,F as g,t as k,u as C,C as v,x as b}from"./index-Bnh-aLYr.js";import{_ as y}from"./uv-loading-page.D2Jx5K50.js";import{_ as x,r as V}from"./uni-app.es.CdPVnhCL.js";import{_ as D,a as L}from"./uv-checkbox-group.wc67Hfdr.js";import{_ as j}from"./uv-number-box.rFW6aLoF.js";import{_ as w}from"./uv-empty.CjW0sggQ.js";import"./uv-icon.DWcsmyzS.js";const F=x({data:()=>({theme:"",themeColor:"",loading:!0,allChecked:!1,allCheckedValue:[],dataList:[],result:[],total:"0.00"}),onShow(){let a=r(),t=e(),l={goods_id:0,url:t[t.length-1].route,platform:a.globalData.systemInfo.uniPlatform,model:a.globalData.systemInfo.deviceModel};this.$apis.visit.add(l),this.initData()},methods:{async initData(){let e,a=r(),t=this;await t.$onLaunched,t.theme=a.globalData.theme,t.themeColor=a.globalData.themeColor,e=await t.$apis.cart.getList({size:100}),t.dataList=e.data,t.loading=!1},turnUrl(e="",s=1){e&&"#"!=e&&(1==s&&a({url:e}),2==s&&t({url:e}),3==s&&l({url:e}))},changeAmount(e){let a=this,t=a.dataList,l=e.value,s=e.name;a.$apis.cart.editData({amount:l,id:s}).then((e=>{if(0==e.code){for(var o=0;o<t.length;o++)t[o].id==s&&(t[o].amount=l);a.dataList=t;let e=0,c=a.result;for(o=0;o<t.length;o++)1==t[o].is_effective&&c.includes(t[o].id)&&(e+=t[o].price*t[o].amount);a.total=e.toFixed(2)}else console.log(e.msg)}))},checkedAll(){let e=this,a=[],t=e.dataList,l=0;if(e.allChecked=!e.allChecked,e.allChecked){let e=0;for(var s=0;s<t.length;s++)1==t[s].is_effective&&(l+=t[s].price*t[s].amount,a[e]=t[s].id,e+=1)}e.result=a,e.total=l.toFixed(2)},onChange(e){let a=this,t=a.dataList,l=0,s=e,o=0;for(var c=0;c<t.length;c++)1==t[c].is_effective&&(o+=1,s.includes(t[c].id)&&(l+=t[c].price*t[c].amount));o==s.length?(a.allCheckedValue=["all"],a.allChecked=!0):(a.allCheckedValue=[],a.allChecked=!1),a.result=s,a.total=l.toFixed(2)},onSubmit(){let e=this.result;e.length<1?s({title:"请选择商品",icon:"error"}):a({url:"/pages/order/index?cart_id="+e.join(",")})},onDelete(e=""){let a=this,t=a.result;if(""==e&&t.length<1)s({title:"请选择商品",icon:"error"});else{let l=t.length<1?e:t.join(",");o({title:"提示",content:"确认要删除吗？",success(e){e.confirm&&a.$apis.cart.deleteData({id:l}).then((e=>{0==e.code?(a.result=[],a.initData()):s({title:e.msg,icon:"none"})}))}})}}}},[["render",function(e,a,t,l,s,o){const r=V(c("uv-loading-page"),y),x=u,F=V(c("uv-checkbox"),D),U=b,A=V(c("uv-number-box"),j),$=V(c("uv-checkbox-group"),L),S=V(c("uv-empty"),w);return _(),i(x,{class:d(["content",s.theme])},{default:n((()=>[m(r,{loading:s.loading},null,8,["loading"]),s.loading?C("",!0):(_(),h(g,{key:0},[m(x,{class:"header"},{default:n((()=>[m(x,{class:"header_ctt"},{default:n((()=>[m(x,{class:"cart_top"},{default:n((()=>[m(x,{class:"cart_top_title"},{default:n((()=>[m(x,null,{default:n((()=>[f("购物车")])),_:1}),m(x,{class:"span"},{default:n((()=>[f("(共"+p(s.dataList.length)+"件宝贝)",1)])),_:1})])),_:1}),m(x,{class:"cart_top_del",onClick:a[0]||(a[0]=e=>o.onDelete())},{default:n((()=>[f("删除")])),_:1})])),_:1})])),_:1})])),_:1}),m(x,{class:"wrap"},{default:n((()=>[m(x,{class:"space_header"}),m(x,{class:"m_ctr"},{default:n((()=>[m($,{modelValue:s.result,"onUpdate:modelValue":a[1]||(a[1]=e=>s.result=e),placement:"column",onChange:o.onChange},{default:n((()=>[(_(!0),h(g,null,k(s.dataList,((e,a)=>(_(),i(x,{class:"yuan_ctr",key:a},{default:n((()=>[m(x,{class:"cart_goods_ctr"},{default:n((()=>[m(x,{class:"cart_goods_checkbox"},{default:n((()=>[1==e.is_effective?(_(),i(F,{key:0,name:e.id,activeColor:s.themeColor,shape:"circle"},null,8,["name","activeColor"])):(_(),i(F,{key:1,name:e.id,disabled:!0,activeColor:s.themeColor,shape:"circle"},null,8,["name","activeColor"]))])),_:2},1024),m(x,{class:"cart_goods_pic",onClick:a=>o.turnUrl("/pages/goods/detail?id="+e.goods_id)},{default:n((()=>[m(U,{mode:"widthFix",src:e.pic},null,8,["src"])])),_:2},1032,["onClick"]),m(x,{class:"cart_goods_ctt"},{default:n((()=>[m(x,{class:"cart_goods_title",style:v(""==e.spec_key_name?"-webkit-line-clamp:2;":"")},{default:n((()=>[f(p(e.title),1)])),_:2},1032,["style"]),""!=e.spec_key_name?(_(),i(x,{key:0,class:"cart_goods_subtitle"},{default:n((()=>[f(p(e.spec_key_name),1)])),_:2},1024)):C("",!0),m(x,{class:"cart_goods_price"},{default:n((()=>[f("¥"+p(e.price),1)])),_:2},1024),1==e.is_effective?(_(),i(x,{key:1,class:"cart_amount_ctr"},{default:n((()=>[m(A,{modelValue:e.amount,"onUpdate:modelValue":a=>e.amount=a,name:e.id,min:1,max:e.stock,buttonSize:"44rpx",inputWidth:"60rpx",integer:"",onChange:o.changeAmount},null,8,["modelValue","onUpdate:modelValue","name","max","onChange"])])),_:2},1024)):(_(),i(x,{key:2,class:"cart_amount_ctr",style:{bottom:"16rpx"}},{default:n((()=>[m(x,null,{default:n((()=>[f("已失效")])),_:1}),m(x,{class:"del_btn",onClick:a=>o.onDelete(e.id)},{default:n((()=>[f("删除")])),_:2},1032,["onClick"])])),_:2},1024))])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["modelValue","onChange"]),s.dataList.length<1?(_(),i(x,{key:0,class:"none_ctr"},{default:n((()=>[m(S,{icon:"/static/images/none.png",text:"暂无商品"})])),_:1})):C("",!0)])),_:1}),m(x,{class:"space_footer"})])),_:1}),s.dataList.length>0?(_(),i(x,{key:0,class:"cart_footer"},{default:n((()=>[m(x,{class:"footer_ctt"},{default:n((()=>[m(x,{class:"cart_left"},{default:n((()=>[m($,{modelValue:s.allCheckedValue,"onUpdate:modelValue":a[2]||(a[2]=e=>s.allCheckedValue=e),onChange:o.checkedAll},{default:n((()=>[m(F,{shape:"circle",activeColor:s.themeColor,name:"all",label:"全选"},null,8,["activeColor"])])),_:1},8,["modelValue","onChange"])])),_:1}),m(x,{class:"cart_price"},{default:n((()=>[m(x,{class:"price_title"},{default:n((()=>[f("合计：")])),_:1}),m(x,{class:"price_fh"},{default:n((()=>[f("¥")])),_:1}),m(x,{class:"price"},{default:n((()=>[f(p(s.total),1)])),_:1})])),_:1}),m(x,{class:"cart_btn",onClick:o.onSubmit},{default:n((()=>[f("立即结算")])),_:1},8,["onClick"])])),_:1})])),_:1})):C("",!0)],64))])),_:1},8,["class"])}],["__scopeId","data-v-a8934543"]]);export{F as default};
