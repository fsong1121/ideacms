import{s as e,V as o,g as t,a as s,h as l,c as a,A as c,m as i,n as d,X as u,d as _,r as n,e as p,o as r,f as m,w as f,i as g,j as k,k as y,l as h,p as C,C as b,F as x,t as w,q as v,v as D,u as L,x as S,S as I,z,y as $}from"./index-DZAdU3tA.js";import{_ as j}from"./uv-loading-page.BWWaS0er.js";import{_ as N,r as P}from"./uni-app.es.aySs7ojS.js";import{_ as U}from"./uv-icon.u8BLdT_1.js";import{_ as T}from"./uv-popup.CJT0K_33.js";import{_ as F}from"./uv-number-box.DpVRRcRs.js";import{_ as R}from"./uv-badge.9OG_J1y3.js";import{r as W}from"./replaceImg.kAoIxrIV.js";const V=N({data:()=>({theme:"",themeColor:"",commColor:"",loading:!0,currentID:0,windowWidth:0,duration:1e3,isLogin:!1,cartNumber:0,isCollect:!1,detail:{},goods:{amount:1,stock:0,price:9999,market_price:9999,pic:"",spec_key_arr:[],spec_key:"",spec_key_name:""},buyType:0}),onLoad(t){let s=this;if(Reflect.ownKeys(t).length>0){if(t.hasOwnProperty("scene")){let o=decodeURIComponent(t.scene).split("_");e("pid",o[0]),s.currentID=o[1]}t.hasOwnProperty("id")&&(s.currentID=t.id)}o({success:e=>{s.windowWidth=e.windowWidth>480?480:e.windowWidth}}),s.initData()},onShow(){let e=k(),o=t(),s={goods_id:0,url:o[o.length-1].route,platform:e.globalData.systemInfo.uniPlatform,model:e.globalData.systemInfo.deviceModel};this.$apis.visit.add(s)},onPullDownRefresh(){s({title:"加载中"}),this.initData("refresh")},methods:{async initData(e=""){let o,t=k(),s=this;if(await s.$onLaunched,s.theme=t.globalData.theme,s.themeColor=t.globalData.themeColor,s.commColor=t.globalData.commColor,o=await s.$apis.goods.getData({id:s.currentID}),0==o.code){o.data.info=W.formatRichText(o.data.info),o.data.info=o.data.info.replace('src="/','src="'+t.globalData.siteInfo.url+"/"),s.detail=o.data,s.updateShareData(o.data.title,s.detail.slide[0]),s.title=o.data.title;let e=s.goods;if(e.stock=o.data.stock,e.price=o.data.price,e.market_price=o.data.market_price,e.pic=o.data.pic,1==o.data.multi_spec){let t=0;for(let s=0;s<o.data.spec_str.length;s++)for(let l=0;l<o.data.spec_str[s].items.length;l++)if(1==o.data.spec_str[s].items[l].select){e.spec_key_arr[t]=o.data.spec_str[s].items[l].title,t+=1;break}e.spec_key=e.spec_key_arr.join("-")}s.goods=e}o=await s.$apis.collect.getData({id:s.currentID,type:1}),0==o.code?(s.isLogin=!0,s.isCollect=!0):(s.isLogin=!1,s.isCollect=!1),o=await s.$apis.cart.getList(0,{size:100}),0==o.code?s.cartNumber=o.goods_amount:s.cartNumber=0,s.getSpec(),"refresh"==e&&(l(),a()),s.loading=!1},getSpec(){let e=this;e.$apis.goods.getSpec({goods_id:e.currentID,spec_key:e.goods.spec_key}).then((o=>{0==o.code?(e.goods.stock=o.data.stock,e.goods.price=o.data.price,e.goods.market_price=o.data.market_price,e.goods.spec_key_name=o.data.spec_key_name):console.log(o.msg)}))},showCoupon(){this.$refs.popupCoupon.open()},showSpec(e){this.$refs.popupSpec.open(),this.buyType=e},showDiscount(e){this.$refs.popupDiscount.open()},showService(){this.$refs.popupService.open()},changeAmount(e){this.goods.amount=e.value},changeSpec(e,o){let t=this;t.goods.spec_key_arr[e]=o,t.goods.spec_key=t.goods.spec_key_arr.join("-"),t.getSpec()},getCoupon(e,o){let t=this;t.$apis.coupon.saveData({uuid:o}).then((o=>{0==o.code?c({title:"领取成功",icon:"success",duration:1e3,success:()=>{t.detail.couponList[e].is_get=1}}):c({title:o.msg,icon:"none"})}))},toCollect(){let e=this,o="收藏成功";e.$apis.collect.saveData({id:e.currentID,type:1}).then((t=>{0==t.code?(e.isCollect=!e.isCollect,e.isCollect||(o="取消收藏"),c({title:o,icon:"none"})):c({title:t.msg,icon:"none"})}))},onCall(){let e=k();i({phoneNumber:e.globalData.siteInfo.phone})},buttonClick(e){this.showSpec(e)},toCart(){let e=this;e.$apis.cart.saveData({goods_id:e.currentID,spec_key:e.goods.spec_key,amount:e.goods.amount}).then((o=>{0==o.code?(e.$refs.popupSpec.close(),e.cartNumber=e.cartNumber+e.goods.amount,c({title:"加入成功"})):c({title:o.msg,icon:"none"})}))},toBuy(){let e=this;e.goods.stock>=e.goods.amount?(e.$refs.popupSpec.close(),d({url:"/pages/order/index?goods_id="+e.currentID+"&spec_key="+encodeURIComponent(e.goods.spec_key)+"&amount="+e.goods.amount})):c({title:"库存不足",icon:"none"})},showPic(e){u({urls:this.detail.commentList[0].pic,current:e})},turnUrl(e="",o=1){e&&"#"!=e&&(1==o&&d({url:e}),2==o&&_({url:e}),3==o&&n({url:e}))}}},[["render",function(e,o,t,s,l,a){const c=P(p("uv-loading-page"),j),i=S,d=$,u=I,_=y,n=P(p("uv-icon"),U),k=z,N=P(p("uv-popup"),T),W=P(p("uv-number-box"),F),V=P(p("uv-badge"),R);return r(),m(_,{class:g(["content",l.theme])},{default:f((()=>[h(c,{loading:l.loading},null,8,["loading"]),l.loading?L("",!0):(r(),C(x,{key:0},[h(_,{class:"wrap"},{default:f((()=>[h(_,{class:"m_ctr pd_0"},{default:f((()=>[h(u,{"indicator-dots":"true",autoplay:"true",duration:l.duration,style:b({height:l.windowWidth+"px"})},{default:f((()=>[(r(!0),C(x,null,w(l.detail.slide,((e,o)=>(r(),m(d,{key:o},{default:f((()=>[h(i,{src:e,class:"slide-image"},null,8,["src"])])),_:2},1024)))),128))])),_:1},8,["duration","style"])])),_:1}),h(_,{class:"m_ctr"},{default:f((()=>[h(_,{class:"yuan_ctr pd_0"},{default:f((()=>[h(_,{class:"m_ctr pd_20"},{default:f((()=>[h(_,{class:"goods_price"},{default:f((()=>[h(_,null,{default:f((()=>[v("¥"+D(l.goods.price),1)])),_:1}),h(_,{class:"span"},{default:f((()=>[v("¥"+D(l.goods.market_price),1)])),_:1})])),_:1}),l.detail.couponList.length>0?(r(),m(_,{key:0,class:"goods_coupon"},{default:f((()=>[h(_,{class:"goods_coupon_ctt"},{default:f((()=>[(r(!0),C(x,null,w(l.detail.couponList,((e,o)=>(r(),m(_,{class:"goods_cell_cx",key:o},{default:f((()=>[v("满"+D(e.min_price1)+"减"+D(e.cut_price1),1)])),_:2},1024)))),128))])),_:1}),h(_,{class:"goods_coupon_more",onClick:a.showCoupon},{default:f((()=>[v("领券")])),_:1},8,["onClick"])])),_:1})):L("",!0),h(_,{class:"goods_title"},{default:f((()=>[v(D(l.detail.title),1)])),_:1}),h(_,{class:"goods_subtitle"},{default:f((()=>[v(D(l.detail.subtitle),1)])),_:1})])),_:1}),h(_,{class:"goods_share"},{default:f((()=>[h(_,{class:"goods_share_cell"},{default:f((()=>[h(_,null,{default:f((()=>[h(n,{name:"logistics","custom-prefix":"custom-icon",color:"#999",size:"28rpx"})])),_:1}),h(_,{class:"txt"},{default:f((()=>[v("已售"+D(l.detail.sales)+"件",1)])),_:1})])),_:1}),h(_,{class:"goods_share_cell",onClick:a.toCollect},{default:f((()=>[l.isCollect?(r(),m(_,{key:0},{default:f((()=>[h(n,{name:"like","custom-prefix":"custom-icon",color:l.commColor,size:"28rpx"},null,8,["color"])])),_:1})):(r(),m(_,{key:1},{default:f((()=>[h(n,{name:"like-o","custom-prefix":"custom-icon",color:"#999",size:"28rpx"})])),_:1})),h(_,{class:"txt"},{default:f((()=>[v("收藏")])),_:1})])),_:1},8,["onClick"]),h(_,{class:"goods_share_cell"},{default:f((()=>[h(_,null,{default:f((()=>[h(n,{name:"share-o","custom-prefix":"custom-icon",color:"#999",size:"28rpx"})])),_:1}),h(_,{class:"txt"},{default:f((()=>[v("分享")])),_:1})])),_:1})])),_:1})])),_:1}),h(_,{class:"yuan_ctr"},{default:f((()=>[h(_,{class:"goods_cell",onClick:o[0]||(o[0]=e=>a.showSpec(0))},{default:f((()=>[h(_,{class:"goods_cell_title"},{default:f((()=>[v("选择")])),_:1}),h(_,{class:"goods_cell_ctt"},{default:f((()=>[v(D(1==l.detail.multi_spec?l.goods.spec_key_name+",":"")+D(l.goods.amount)+"件 ",1)])),_:1}),h(_,{class:"goods_cell_ico"},{default:f((()=>[h(n,{name:"arrow","custom-prefix":"custom-icon",color:"#ccc",size:"24rpx"})])),_:1})])),_:1}),l.detail.discountList.length>0?(r(),m(_,{key:0,class:"goods_cell",onClick:a.showDiscount},{default:f((()=>[h(_,{class:"goods_cell_title"},{default:f((()=>[v("促销")])),_:1}),h(_,{class:"goods_cell_ctt"},{default:f((()=>[(r(!0),C(x,null,w(l.detail.discountList,((e,o)=>(r(),m(_,{class:"goods_cell_cx",key:o},{default:f((()=>[v(D(e.title),1)])),_:2},1024)))),128))])),_:1}),h(_,{class:"goods_cell_ico"},{default:f((()=>[h(n,{name:"arrow","custom-prefix":"custom-icon",color:"#ccc",size:"24rpx"})])),_:1})])),_:1},8,["onClick"])):L("",!0),l.detail.service.length>0?(r(),m(_,{key:1,class:"goods_cell",onClick:a.showService},{default:f((()=>[h(_,{class:"goods_cell_title"},{default:f((()=>[v("服务")])),_:1}),h(_,{class:"goods_cell_ctt"},{default:f((()=>[(r(!0),C(x,null,w(l.detail.service,((e,o)=>(r(),m(_,{class:"goods_cell_fw",key:o},{default:f((()=>[h(n,{name:"passed","custom-prefix":"custom-icon",color:l.commColor,size:"24rpx"},null,8,["color"]),h(_,{class:"txt"},{default:f((()=>[v(D(e.title),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),h(_,{class:"goods_cell_ico"},{default:f((()=>[h(n,{name:"arrow","custom-prefix":"custom-icon",color:"#ccc",size:"24rpx"})])),_:1})])),_:1},8,["onClick"])):L("",!0)])),_:1}),l.detail.commentList.length>0?(r(),m(_,{key:0,class:"yuan_ctr"},{default:f((()=>[h(_,{class:"goods_info_title"},{default:f((()=>[h(_,{class:"goods_info_title_left"},{default:f((()=>[v("宝贝评价("+D(l.detail.commentCount)+")",1)])),_:1}),h(_,{class:"goods_info_title_right",onClick:o[1]||(o[1]=e=>a.turnUrl("/pages/goods/comment?id="+l.detail.id))},{default:f((()=>[v("查看全部 >")])),_:1})])),_:1}),h(_,{class:"goods_comment_ctr"},{default:f((()=>[h(_,{class:"goods_comment_title"},{default:f((()=>[h(_,{class:"goods_comment_avatar"},{default:f((()=>[h(i,{mode:"widthFix",src:l.detail.commentList[0].avatar},null,8,["src"])])),_:1}),h(_,{class:"goods_comment_txt"},{default:f((()=>[h(_,null,{default:f((()=>[v(D(l.detail.commentList[0].user_name),1)])),_:1}),h(_,{class:"span"},{default:f((()=>[h(_,null,{default:f((()=>[v(D(l.detail.commentList[0].new_add_date),1)])),_:1}),""!=l.detail.commentList[0].spec_key_name?(r(),m(_,{key:0,style:{margin:"0 8rpx"}},{default:f((()=>[v("|")])),_:1})):L("",!0),""!=l.detail.commentList[0].spec_key_name?(r(),m(_,{key:1},{default:f((()=>[v(D(l.detail.commentList[0].spec_key_name),1)])),_:1})):L("",!0)])),_:1})])),_:1})])),_:1}),h(_,{class:"goods_comment_info"},{default:f((()=>[v(D(l.detail.commentList[0].info),1)])),_:1}),l.detail.commentList[0].pic.length>0?(r(),m(_,{key:0,class:"goods_comment_pic_ctr"},{default:f((()=>[(r(!0),C(x,null,w(l.detail.commentList[0].pic,((e,o)=>(r(),C(x,{key:o},[o<4?(r(),m(_,{key:0,class:"goods_comment_pic"},{default:f((()=>[h(i,{mode:"widthFix",src:e,onClick:e=>{a.showPic(o)}},null,8,["src","onClick"])])),_:2},1024)):L("",!0)],64)))),128))])),_:1})):L("",!0)])),_:1})])),_:1})):L("",!0),h(_,{class:"yuan_ctr"},{default:f((()=>[h(_,{class:"goods_info_title"},{default:f((()=>[v("商品详情")])),_:1}),h(_,{class:"m_ctr pd_0"},{default:f((()=>[h(k,{space:"nbsp",nodes:l.detail.info},null,8,["nodes"])])),_:1})])),_:1}),h(N,{ref:"popupCoupon",mode:"bottom",round:"10",closeable:!0},{default:f((()=>[h(_,{class:"popup_ctr"},{default:f((()=>[h(_,{class:"popup_title"},{default:f((()=>[v("领券更优惠")])),_:1}),(r(!0),C(x,null,w(l.detail.couponList,((e,o)=>(r(),m(_,{class:"popup_coupon_ctr",key:o},{default:f((()=>[h(_,{class:"popup_coupon_left"},{default:f((()=>[h(_,{class:"popup_coupon_title"},{default:f((()=>[v(D(e.title),1)])),_:2},1024),h(_,{class:"popup_coupon_price"},{default:f((()=>[h(_,null,{default:f((()=>[v("¥"+D(e.cut_price),1)])),_:2},1024),h(_,{class:"span"},{default:f((()=>[v("满"+D(e.min_price)+"元可用",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),h(_,{class:"popup_coupon_fg"}),h(_,{class:"popup_coupon_right"},{default:f((()=>[e.is_get?(r(),m(_,{key:0,class:"popup_coupon_btn_none"},{default:f((()=>[v("已领取")])),_:1})):(r(),m(_,{key:1,class:"popup_coupon_btn",onClick:t=>a.getCoupon(o,e.uuid)},{default:f((()=>[v("立即领取")])),_:2},1032,["onClick"]))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},512),h(N,{ref:"popupSpec",mode:"bottom",round:"10",closeable:!0},{default:f((()=>[h(_,{class:"popup_ctr"},{default:f((()=>[h(_,{class:"popup_goods_ctr"},{default:f((()=>[h(_,{class:"popup_goods_pic"},{default:f((()=>[h(i,{mode:"widthFix",src:l.goods.pic},null,8,["src"])])),_:1}),h(_,{class:"popup_goods_ctt"},{default:f((()=>[h(_,{class:"popup_goods_price"},{default:f((()=>[v("¥"+D(l.goods.price),1)])),_:1}),h(_,null,{default:f((()=>[v("库存："+D(l.goods.stock),1)])),_:1}),h(_,null,{default:f((()=>[v(" 已选："+D(1==l.detail.multi_spec?l.goods.spec_key_name+",":"")+D(l.goods.amount)+"件 ",1)])),_:1})])),_:1})])),_:1}),1==l.detail.multi_spec?(r(),m(_,{key:0,class:"popup_goods_ctr"},{default:f((()=>[(r(!0),C(x,null,w(l.detail.spec_str,((e,o)=>(r(),C(x,{key:o},[h(_,{class:"popup_goods_spec_title"},{default:f((()=>[v(D(e.spec),1)])),_:2},1024),(r(!0),C(x,null,w(e.items,((e,t)=>(r(),C(x,{key:t},[1==e.select?(r(),m(_,{key:0,class:g(l.goods.spec_key_arr[o]==e.title?"popup_goods_spec_btn_on":"popup_goods_spec_btn"),onClick:t=>a.changeSpec(o,e.title)},{default:f((()=>[v(D(e.title),1)])),_:2},1032,["class","onClick"])):L("",!0)],64)))),128))],64)))),128))])),_:1})):L("",!0),h(_,{class:"popup_goods_ctr"},{default:f((()=>[h(_,{class:"popup_amount_ctr"},{default:f((()=>[h(_,{class:"popup_goods_spec_title"},{default:f((()=>[v("数量")])),_:1}),h(W,{modelValue:l.goods.amount,"onUpdate:modelValue":o[2]||(o[2]=e=>l.goods.amount=e),buttonSize:"28",min:1,max:l.goods.stock,onChange:a.changeAmount},null,8,["modelValue","max","onChange"])])),_:1})])),_:1}),h(_,{class:"m_ctr pd_0"},{default:f((()=>[l.goods.stock>0?(r(),m(_,{key:0},{default:f((()=>[0==l.buyType?(r(),m(_,{key:0,class:"m_ctr pd_0"},{default:f((()=>[h(_,{class:"popup_goods_btn_cart",onClick:a.toCart},{default:f((()=>[v("加入购物车")])),_:1},8,["onClick"]),h(_,{class:"popup_goods_btn_buy",onClick:a.toBuy},{default:f((()=>[v("立即购买")])),_:1},8,["onClick"])])),_:1})):L("",!0),1==l.buyType?(r(),m(_,{key:1,class:"popup_goods_btn",onClick:a.toCart},{default:f((()=>[v("确定")])),_:1},8,["onClick"])):L("",!0),2==l.buyType?(r(),m(_,{key:2,class:"popup_goods_btn",onClick:a.toBuy},{default:f((()=>[v("确定")])),_:1},8,["onClick"])):L("",!0)])),_:1})):(r(),m(_,{key:1,class:"popup_goods_btn_none"},{default:f((()=>[v("已售罄")])),_:1}))])),_:1})])),_:1})])),_:1},512),h(N,{ref:"popupDiscount",mode:"bottom",round:"10",closeable:!0},{default:f((()=>[h(_,{class:"popup_ctr"},{default:f((()=>[h(_,{class:"popup_title"},{default:f((()=>[v("促销活动")])),_:1}),(r(!0),C(x,null,w(l.detail.discountList,((e,o)=>(r(),m(_,{class:"popup_service_txt",key:o},{default:f((()=>[h(_,{class:"popup_service_title"},{default:f((()=>[h(n,{name:"passed","custom-prefix":"custom-icon",color:l.commColor,size:"24rpx"},null,8,["color"]),h(_,{class:"txt"},{default:f((()=>[v(D(e.title),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},512),h(N,{ref:"popupService",mode:"bottom",round:"10",closeable:!0},{default:f((()=>[h(_,{class:"popup_ctr"},{default:f((()=>[h(_,{class:"popup_title"},{default:f((()=>[v("商品服务保障")])),_:1}),(r(!0),C(x,null,w(l.detail.service,((e,o)=>(r(),m(_,{class:"popup_service_txt",key:o},{default:f((()=>[h(_,{class:"popup_service_title"},{default:f((()=>[h(n,{name:"passed","custom-prefix":"custom-icon",color:l.commColor,size:"24rpx"},null,8,["color"]),h(_,{class:"txt"},{default:f((()=>[v(D(e.title),1)])),_:2},1024)])),_:2},1024),h(_,{class:"popup_service_info"},{default:f((()=>[v(D(e.info),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},512)])),_:1}),h(_,{class:"space_footer"})])),_:1}),h(_,{class:"footer"},{default:f((()=>[h(_,{class:"footer_ctt"},{default:f((()=>[h(_,{class:"ico_ctr",onClick:o[3]||(o[3]=e=>a.turnUrl("/pages/index/index",2))},{default:f((()=>[h(n,{name:"home-o","custom-prefix":"custom-icon",size:"40rpx"}),h(_,null,{default:f((()=>[v("首页")])),_:1})])),_:1}),h(_,{class:"ico_ctr",onClick:o[4]||(o[4]=e=>a.turnUrl("/pages/cart/index",2))},{default:f((()=>[h(n,{name:"cart-o","custom-prefix":"custom-icon",size:"40rpx"}),h(V,{type:"error",max:"99",value:l.cartNumber,offset:[0,-4],absolute:!0},null,8,["value"]),h(_,null,{default:f((()=>[v("购物车")])),_:1})])),_:1}),h(_,{class:"ico_ctr"},{default:f((()=>[h(n,{name:"chat-o","custom-prefix":"custom-icon",size:"40rpx",onClick:a.onCall},null,8,["onClick"]),h(_,null,{default:f((()=>[v("客服")])),_:1})])),_:1}),h(_,{class:"btn_ctr"},{default:f((()=>[0==l.detail.type?(r(),C(x,{key:0},[h(_,{class:"cart_btn",onClick:o[5]||(o[5]=e=>a.buttonClick(1))},{default:f((()=>[v("加入购物车")])),_:1}),h(_,{class:"buy_btn",onClick:o[6]||(o[6]=e=>a.buttonClick(2))},{default:f((()=>[v("立即购买")])),_:1})],64)):(r(),m(_,{key:1,class:"buy_btn",style:{width:"100%"},onClick:o[7]||(o[7]=e=>a.buttonClick(2))},{default:f((()=>[v("立即购买")])),_:1}))])),_:1})])),_:1})])),_:1})],64))])),_:1},8,["class"])}],["__scopeId","data-v-3c4ab825"]]);export{V as default};
