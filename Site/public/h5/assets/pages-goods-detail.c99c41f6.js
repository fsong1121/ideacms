import{s as e,V as o,g as t,a as s,h as l,c as a,A as c,m as i,n as u,X as d,d as _,r as n,o as p,e as r,w as m,f,i as g,j as k,k as h,l as y,C,F as b,q as x,p as w,u as v,t as D,v as L,x as S,S as I,z,y as $}from"./index-8b182b74.js";import{_ as j}from"./uv-loading-page.792746ec.js";import{_ as P,r as N}from"./uni-app.es.90f08a56.js";import{_ as U}from"./uv-icon.70699d37.js";import{_ as T}from"./uv-popup.eb2a5516.js";import{_ as F}from"./uv-number-box.4ef25658.js";import{_ as R}from"./uv-badge.8ff43380.js";import{r as W}from"./replaceImg.54141da6.js";const V=P({data:()=>({theme:"",themeColor:"",commColor:"",loading:!0,currentID:0,windowWidth:0,duration:1e3,isLogin:!1,picPath:"",cartNumber:0,isCollect:!1,detail:{},goods:{amount:1,stock:0,price:9999,market_price:9999,pic:"",spec_key_arr:[],spec_key:"",spec_key_name:""},buyType:0}),onLoad(t){let s=this;if(Reflect.ownKeys(t).length>0){if(t.hasOwnProperty("scene")){let o=decodeURIComponent(t.scene).split("_");e("pid",o[0]),s.currentID=o[1]}t.hasOwnProperty("id")&&(s.currentID=t.id)}o({success:e=>{s.windowWidth=e.windowWidth>480?480:e.windowWidth}}),s.initData()},onShow(){let e=g(),o=t(),s={goods_id:0,url:o[o.length-1].route,platform:e.globalData.systemInfo.uniPlatform,model:e.globalData.systemInfo.deviceModel};this.$apis.visit.add(s)},onPullDownRefresh(){s({title:"加载中"}),this.initData("refresh")},methods:{async initData(e=""){let o,t=g(),s=this;if(await s.$onLaunched,s.theme=t.globalData.theme,s.themeColor=t.globalData.themeColor,s.commColor=t.globalData.commColor,s.picPath=t.globalData.siteInfo.url+"/upload/pic/",o=await s.$apis.goods.getData({id:s.currentID}),0==o.code){o.data.info=W.formatRichText(o.data.info),o.data.info=o.data.info.replace(/src=\"/g,'src="'+t.globalData.siteInfo.url),s.detail=o.data,s.updateShareData(o.data.title,s.picPath+s.detail.slide[0]),s.title=o.data.title;let e=s.goods;if(e.stock=o.data.stock,e.price=o.data.price,e.market_price=o.data.market_price,e.pic=o.data.pic,1==o.data.multi_spec){let t=0;for(let s=0;s<o.data.spec_str.length;s++)for(let l=0;l<o.data.spec_str[s].items.length;l++)if(1==o.data.spec_str[s].items[l].select){e.spec_key_arr[t]=o.data.spec_str[s].items[l].title,t+=1;break}e.spec_key=e.spec_key_arr.join("-")}s.goods=e}o=await s.$apis.collect.getData({id:s.currentID,type:1}),0==o.code?(s.isLogin=!0,s.isCollect=!0):(s.isLogin=!1,s.isCollect=!1),o=await s.$apis.cart.getList(0,{size:100}),0==o.code?s.cartNumber=o.goods_amount:s.cartNumber=0,s.getSpec(),"refresh"==e&&(l(),a()),s.loading=!1},getSpec(){let e=this;e.$apis.goods.getSpec({goods_id:e.currentID,spec_key:e.goods.spec_key}).then((o=>{0==o.code?(e.goods.stock=o.data.stock,e.goods.price=o.data.price,e.goods.market_price=o.data.market_price,e.goods.spec_key_name=o.data.spec_key_name):console.log(o.msg)}))},showCoupon(){this.$refs.popupCoupon.open()},showSpec(e){this.$refs.popupSpec.open(),this.buyType=e},showDiscount(e){this.$refs.popupDiscount.open()},showService(){this.$refs.popupService.open()},changeAmount(e){this.goods.amount=e.value},changeSpec(e,o){let t=this;t.goods.spec_key_arr[e]=o,t.goods.spec_key=t.goods.spec_key_arr.join("-"),t.getSpec()},getCoupon(e,o){let t=this;t.$apis.coupon.saveData({uuid:o}).then((o=>{0==o.code?c({title:"领取成功",icon:"success",duration:1e3,success:()=>{t.detail.couponList[e].is_get=1}}):c({title:o.msg,icon:"none"})}))},toCollect(){let e=this,o="收藏成功";e.$apis.collect.saveData({id:e.currentID,type:1}).then((t=>{0==t.code?(e.isCollect=!e.isCollect,e.isCollect||(o="取消收藏"),c({title:o,icon:"none"})):c({title:t.msg,icon:"none"})}))},onCall(){let e=g();i({phoneNumber:e.globalData.siteInfo.phone})},buttonClick(e){this.showSpec(e)},toCart(){let e=this;e.$apis.cart.saveData({goods_id:e.currentID,spec_key:e.goods.spec_key,amount:e.goods.amount}).then((o=>{0==o.code?(e.$refs.popupSpec.close(),e.cartNumber=e.cartNumber+e.goods.amount,c({title:"加入成功"})):c({title:o.msg,icon:"none"})}))},toBuy(){let e=this;e.goods.stock>=e.goods.amount?(e.$refs.popupSpec.close(),u({url:"/pages/order/index?goods_id="+e.currentID+"&spec_key="+encodeURIComponent(e.goods.spec_key)+"&amount="+e.goods.amount})):c({title:"库存不足",icon:"none"})},showPic(e){d({urls:this.detail.commentList[0].pic,current:e})},turnUrl(e="",o=1){e&&"#"!=e&&(1==o&&u({url:e}),2==o&&_({url:e}),3==o&&n({url:e}))}}},[["render",function(e,o,t,s,l,a){const c=N(L("uv-loading-page"),j),i=S,u=$,d=I,_=k,n=N(L("uv-icon"),U),g=z,P=N(L("uv-popup"),T),W=N(L("uv-number-box"),F),V=N(L("uv-badge"),R);return p(),r(_,{class:f(["content",l.theme])},{default:m((()=>[h(c,{loading:l.loading},null,8,["loading"]),l.loading?D("",!0):(p(),y(b,{key:0},[h(_,{class:"wrap"},{default:m((()=>[h(_,{class:"m_ctr pd_0"},{default:m((()=>[h(d,{"indicator-dots":"true",autoplay:"true",duration:l.duration,style:C({height:l.windowWidth+"px"})},{default:m((()=>[(p(!0),y(b,null,x(l.detail.slide,((e,o)=>(p(),r(u,{key:o},{default:m((()=>[h(i,{src:l.picPath+e,class:"slide-image"},null,8,["src"])])),_:2},1024)))),128))])),_:1},8,["duration","style"])])),_:1}),h(_,{class:"m_ctr"},{default:m((()=>[h(_,{class:"yuan_ctr pd_0"},{default:m((()=>[h(_,{class:"m_ctr pd_20"},{default:m((()=>[h(_,{class:"goods_price"},{default:m((()=>[h(_,null,{default:m((()=>[w("¥"+v(l.goods.price),1)])),_:1}),h(_,{class:"span"},{default:m((()=>[w("¥"+v(l.goods.market_price),1)])),_:1})])),_:1}),l.detail.couponList.length>0?(p(),r(_,{key:0,class:"goods_coupon"},{default:m((()=>[h(_,{class:"goods_coupon_ctt"},{default:m((()=>[(p(!0),y(b,null,x(l.detail.couponList,((e,o)=>(p(),r(_,{class:"goods_cell_cx",key:o},{default:m((()=>[w("满"+v(e.min_price1)+"减"+v(e.cut_price1),1)])),_:2},1024)))),128))])),_:1}),h(_,{class:"goods_coupon_more",onClick:a.showCoupon},{default:m((()=>[w("领券")])),_:1},8,["onClick"])])),_:1})):D("",!0),h(_,{class:"goods_title"},{default:m((()=>[w(v(l.detail.title),1)])),_:1}),h(_,{class:"goods_subtitle"},{default:m((()=>[w(v(l.detail.subtitle),1)])),_:1})])),_:1}),h(_,{class:"goods_share"},{default:m((()=>[h(_,{class:"goods_share_cell"},{default:m((()=>[h(_,null,{default:m((()=>[h(n,{name:"logistics","custom-prefix":"custom-icon",color:"#999",size:"28rpx"})])),_:1}),h(_,{class:"txt"},{default:m((()=>[w("已售"+v(l.detail.sales)+"件",1)])),_:1})])),_:1}),h(_,{class:"goods_share_cell",onClick:a.toCollect},{default:m((()=>[l.isCollect?(p(),r(_,{key:0},{default:m((()=>[h(n,{name:"like","custom-prefix":"custom-icon",color:l.commColor,size:"28rpx"},null,8,["color"])])),_:1})):(p(),r(_,{key:1},{default:m((()=>[h(n,{name:"like-o","custom-prefix":"custom-icon",color:"#999",size:"28rpx"})])),_:1})),h(_,{class:"txt"},{default:m((()=>[w("收藏")])),_:1})])),_:1},8,["onClick"]),h(_,{class:"goods_share_cell"},{default:m((()=>[h(_,null,{default:m((()=>[h(n,{name:"share-o","custom-prefix":"custom-icon",color:"#999",size:"28rpx"})])),_:1}),h(_,{class:"txt"},{default:m((()=>[w("分享")])),_:1})])),_:1})])),_:1})])),_:1}),h(_,{class:"yuan_ctr"},{default:m((()=>[h(_,{class:"goods_cell",onClick:o[0]||(o[0]=e=>a.showSpec(0))},{default:m((()=>[h(_,{class:"goods_cell_title"},{default:m((()=>[w("选择")])),_:1}),h(_,{class:"goods_cell_ctt"},{default:m((()=>[w(v(1==l.detail.multi_spec?l.goods.spec_key_name+",":"")+v(l.goods.amount)+"件 ",1)])),_:1}),h(_,{class:"goods_cell_ico"},{default:m((()=>[h(n,{name:"arrow","custom-prefix":"custom-icon",color:"#ccc",size:"24rpx"})])),_:1})])),_:1}),l.detail.discountList.length>0?(p(),r(_,{key:0,class:"goods_cell",onClick:a.showDiscount},{default:m((()=>[h(_,{class:"goods_cell_title"},{default:m((()=>[w("促销")])),_:1}),h(_,{class:"goods_cell_ctt"},{default:m((()=>[(p(!0),y(b,null,x(l.detail.discountList,((e,o)=>(p(),r(_,{class:"goods_cell_cx",key:o},{default:m((()=>[w(v(e.title),1)])),_:2},1024)))),128))])),_:1}),h(_,{class:"goods_cell_ico"},{default:m((()=>[h(n,{name:"arrow","custom-prefix":"custom-icon",color:"#ccc",size:"24rpx"})])),_:1})])),_:1},8,["onClick"])):D("",!0),l.detail.service.length>0?(p(),r(_,{key:1,class:"goods_cell",onClick:a.showService},{default:m((()=>[h(_,{class:"goods_cell_title"},{default:m((()=>[w("服务")])),_:1}),h(_,{class:"goods_cell_ctt"},{default:m((()=>[(p(!0),y(b,null,x(l.detail.service,((e,o)=>(p(),r(_,{class:"goods_cell_fw",key:o},{default:m((()=>[h(n,{name:"passed","custom-prefix":"custom-icon",color:l.commColor,size:"24rpx"},null,8,["color"]),h(_,{class:"txt"},{default:m((()=>[w(v(e.title),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),h(_,{class:"goods_cell_ico"},{default:m((()=>[h(n,{name:"arrow","custom-prefix":"custom-icon",color:"#ccc",size:"24rpx"})])),_:1})])),_:1},8,["onClick"])):D("",!0)])),_:1}),l.detail.commentList.length>0?(p(),r(_,{key:0,class:"yuan_ctr"},{default:m((()=>[h(_,{class:"goods_info_title"},{default:m((()=>[h(_,{class:"goods_info_title_left"},{default:m((()=>[w("宝贝评价("+v(l.detail.commentCount)+")",1)])),_:1}),h(_,{class:"goods_info_title_right",onClick:o[1]||(o[1]=e=>a.turnUrl("/pages/goods/comment?id="+l.detail.id))},{default:m((()=>[w("查看全部 >")])),_:1})])),_:1}),h(_,{class:"goods_comment_ctr"},{default:m((()=>[h(_,{class:"goods_comment_title"},{default:m((()=>[h(_,{class:"goods_comment_avatar"},{default:m((()=>[h(i,{mode:"widthFix",src:l.detail.commentList[0].avatar},null,8,["src"])])),_:1}),h(_,{class:"goods_comment_txt"},{default:m((()=>[h(_,null,{default:m((()=>[w(v(l.detail.commentList[0].user_name),1)])),_:1}),h(_,{class:"span"},{default:m((()=>[h(_,null,{default:m((()=>[w(v(l.detail.commentList[0].new_add_date),1)])),_:1}),""!=l.detail.commentList[0].spec_key_name?(p(),r(_,{key:0,style:{margin:"0 8rpx"}},{default:m((()=>[w("|")])),_:1})):D("",!0),""!=l.detail.commentList[0].spec_key_name?(p(),r(_,{key:1},{default:m((()=>[w(v(l.detail.commentList[0].spec_key_name),1)])),_:1})):D("",!0)])),_:1})])),_:1})])),_:1}),h(_,{class:"goods_comment_info"},{default:m((()=>[w(v(l.detail.commentList[0].info),1)])),_:1}),l.detail.commentList[0].pic.length>0?(p(),r(_,{key:0,class:"goods_comment_pic_ctr"},{default:m((()=>[(p(!0),y(b,null,x(l.detail.commentList[0].pic,((e,o)=>(p(),y(b,{key:o},[o<4?(p(),r(_,{key:0,class:"goods_comment_pic"},{default:m((()=>[h(i,{mode:"widthFix",src:e,onClick:e=>{a.showPic(o)}},null,8,["src","onClick"])])),_:2},1024)):D("",!0)],64)))),128))])),_:1})):D("",!0)])),_:1})])),_:1})):D("",!0),h(_,{class:"yuan_ctr"},{default:m((()=>[h(_,{class:"goods_info_title"},{default:m((()=>[w("商品详情")])),_:1}),h(_,{class:"m_ctr pd_0"},{default:m((()=>[h(g,{space:"nbsp",nodes:l.detail.info},null,8,["nodes"])])),_:1})])),_:1}),h(P,{ref:"popupCoupon",mode:"bottom",round:"10",closeable:!0},{default:m((()=>[h(_,{class:"popup_ctr"},{default:m((()=>[h(_,{class:"popup_title"},{default:m((()=>[w("领券更优惠")])),_:1}),(p(!0),y(b,null,x(l.detail.couponList,((e,o)=>(p(),r(_,{class:"popup_coupon_ctr",key:o},{default:m((()=>[h(_,{class:"popup_coupon_left"},{default:m((()=>[h(_,{class:"popup_coupon_title"},{default:m((()=>[w(v(e.title),1)])),_:2},1024),h(_,{class:"popup_coupon_price"},{default:m((()=>[h(_,null,{default:m((()=>[w("¥"+v(e.cut_price),1)])),_:2},1024),h(_,{class:"span"},{default:m((()=>[w("满"+v(e.min_price)+"元可用",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),h(_,{class:"popup_coupon_fg"}),h(_,{class:"popup_coupon_right"},{default:m((()=>[e.is_get?(p(),r(_,{key:0,class:"popup_coupon_btn_none"},{default:m((()=>[w("已领取")])),_:1})):(p(),r(_,{key:1,class:"popup_coupon_btn",onClick:t=>a.getCoupon(o,e.uuid)},{default:m((()=>[w("立即领取")])),_:2},1032,["onClick"]))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},512),h(P,{ref:"popupSpec",mode:"bottom",round:"10",closeable:!0},{default:m((()=>[h(_,{class:"popup_ctr"},{default:m((()=>[h(_,{class:"popup_goods_ctr"},{default:m((()=>[h(_,{class:"popup_goods_pic"},{default:m((()=>[h(i,{mode:"widthFix",src:l.goods.pic},null,8,["src"])])),_:1}),h(_,{class:"popup_goods_ctt"},{default:m((()=>[h(_,{class:"popup_goods_price"},{default:m((()=>[w("¥"+v(l.goods.price),1)])),_:1}),h(_,null,{default:m((()=>[w("库存："+v(l.goods.stock),1)])),_:1}),h(_,null,{default:m((()=>[w(" 已选："+v(1==l.detail.multi_spec?l.goods.spec_key_name+",":"")+v(l.goods.amount)+"件 ",1)])),_:1})])),_:1})])),_:1}),1==l.detail.multi_spec?(p(),r(_,{key:0,class:"popup_goods_ctr"},{default:m((()=>[(p(!0),y(b,null,x(l.detail.spec_str,((e,o)=>(p(),y(b,{key:o},[h(_,{class:"popup_goods_spec_title"},{default:m((()=>[w(v(e.spec),1)])),_:2},1024),(p(!0),y(b,null,x(e.items,((e,t)=>(p(),y(b,{key:t},[1==e.select?(p(),r(_,{key:0,class:f(l.goods.spec_key_arr[o]==e.title?"popup_goods_spec_btn_on":"popup_goods_spec_btn"),onClick:t=>a.changeSpec(o,e.title)},{default:m((()=>[w(v(e.title),1)])),_:2},1032,["class","onClick"])):D("",!0)],64)))),128))],64)))),128))])),_:1})):D("",!0),h(_,{class:"popup_goods_ctr"},{default:m((()=>[h(_,{class:"popup_amount_ctr"},{default:m((()=>[h(_,{class:"popup_goods_spec_title"},{default:m((()=>[w("数量")])),_:1}),h(W,{modelValue:l.goods.amount,"onUpdate:modelValue":o[2]||(o[2]=e=>l.goods.amount=e),buttonSize:"28",min:1,max:l.goods.stock,onChange:a.changeAmount},null,8,["modelValue","max","onChange"])])),_:1})])),_:1}),h(_,{class:"m_ctr pd_0"},{default:m((()=>[l.goods.stock>0?(p(),r(_,{key:0},{default:m((()=>[0==l.buyType?(p(),r(_,{key:0,class:"m_ctr pd_0"},{default:m((()=>[h(_,{class:"popup_goods_btn_cart",onClick:a.toCart},{default:m((()=>[w("加入购物车")])),_:1},8,["onClick"]),h(_,{class:"popup_goods_btn_buy",onClick:a.toBuy},{default:m((()=>[w("立即购买")])),_:1},8,["onClick"])])),_:1})):D("",!0),1==l.buyType?(p(),r(_,{key:1,class:"popup_goods_btn",onClick:a.toCart},{default:m((()=>[w("确定")])),_:1},8,["onClick"])):D("",!0),2==l.buyType?(p(),r(_,{key:2,class:"popup_goods_btn",onClick:a.toBuy},{default:m((()=>[w("确定")])),_:1},8,["onClick"])):D("",!0)])),_:1})):(p(),r(_,{key:1,class:"popup_goods_btn_none"},{default:m((()=>[w("已售罄")])),_:1}))])),_:1})])),_:1})])),_:1},512),h(P,{ref:"popupDiscount",mode:"bottom",round:"10",closeable:!0},{default:m((()=>[h(_,{class:"popup_ctr"},{default:m((()=>[h(_,{class:"popup_title"},{default:m((()=>[w("促销活动")])),_:1}),(p(!0),y(b,null,x(l.detail.discountList,((e,o)=>(p(),r(_,{class:"popup_service_txt",key:o},{default:m((()=>[h(_,{class:"popup_service_title"},{default:m((()=>[h(n,{name:"passed","custom-prefix":"custom-icon",color:l.commColor,size:"24rpx"},null,8,["color"]),h(_,{class:"txt"},{default:m((()=>[w(v(e.title),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},512),h(P,{ref:"popupService",mode:"bottom",round:"10",closeable:!0},{default:m((()=>[h(_,{class:"popup_ctr"},{default:m((()=>[h(_,{class:"popup_title"},{default:m((()=>[w("商品服务保障")])),_:1}),(p(!0),y(b,null,x(l.detail.service,((e,o)=>(p(),r(_,{class:"popup_service_txt",key:o},{default:m((()=>[h(_,{class:"popup_service_title"},{default:m((()=>[h(n,{name:"passed","custom-prefix":"custom-icon",color:l.commColor,size:"24rpx"},null,8,["color"]),h(_,{class:"txt"},{default:m((()=>[w(v(e.title),1)])),_:2},1024)])),_:2},1024),h(_,{class:"popup_service_info"},{default:m((()=>[w(v(e.info),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},512)])),_:1}),h(_,{class:"space_footer"})])),_:1}),h(_,{class:"footer"},{default:m((()=>[h(_,{class:"footer_ctt"},{default:m((()=>[h(_,{class:"ico_ctr",onClick:o[3]||(o[3]=e=>a.turnUrl("/pages/index/index",2))},{default:m((()=>[h(n,{name:"home-o","custom-prefix":"custom-icon",size:"40rpx"}),h(_,null,{default:m((()=>[w("首页")])),_:1})])),_:1}),h(_,{class:"ico_ctr",onClick:o[4]||(o[4]=e=>a.turnUrl("/pages/cart/index",2))},{default:m((()=>[h(n,{name:"cart-o","custom-prefix":"custom-icon",size:"40rpx"}),h(V,{type:"error",max:"99",value:l.cartNumber,offset:[0,-4],absolute:!0},null,8,["value"]),h(_,null,{default:m((()=>[w("购物车")])),_:1})])),_:1}),h(_,{class:"ico_ctr"},{default:m((()=>[h(n,{name:"chat-o","custom-prefix":"custom-icon",size:"40rpx",onClick:a.onCall},null,8,["onClick"]),h(_,null,{default:m((()=>[w("客服")])),_:1})])),_:1}),h(_,{class:"btn_ctr"},{default:m((()=>[0==l.detail.type?(p(),y(b,{key:0},[h(_,{class:"cart_btn",onClick:o[5]||(o[5]=e=>a.buttonClick(1))},{default:m((()=>[w("加入购物车")])),_:1}),h(_,{class:"buy_btn",onClick:o[6]||(o[6]=e=>a.buttonClick(2))},{default:m((()=>[w("立即购买")])),_:1})],64)):(p(),r(_,{key:1,class:"buy_btn",style:{width:"100%"},onClick:o[7]||(o[7]=e=>a.buttonClick(2))},{default:m((()=>[w("立即购买")])),_:1}))])),_:1})])),_:1})])),_:1})],64))])),_:1},8,["class"])}],["__scopeId","data-v-22c887be"]]);export{V as default};
