import{g as e,n as t,d as a,r as s,H as n,A as o,a as l,h as i,o as r,e as d,w as u,f as c,i as f,j as p,k as _,l as m,p as g,F as y,q as h,u as x,t as k,v as C,C as I,x as v}from"./index-8b182b74.js";import{_ as D}from"./uv-loading-page.792746ec.js";import{_ as S,r as w}from"./uni-app.es.90f08a56.js";import{_ as L}from"./uv-picker.e2dc4cb3.js";import{_ as j}from"./uv-icon.70699d37.js";import{_ as R,a as b}from"./uv-upload.f60950a4.js";import{_ as $}from"./uv-empty.ae111bf2.js";import"./uv-popup.eb2a5516.js";const T=S({data:()=>({theme:"",loading:!0,currentID:0,refundState:-1,typeColumns:[["请选择","仅退款","退货退款"]],typeIndex:0,reasonColumns:[["请选择"]],reasonIndex:0,info:"",fileList:[],data:{},shopConfig:{}}),onLoad(e){let t=this;Reflect.ownKeys(e).length>0&&(t.currentID=e.hasOwnProperty("id")?e.id:0)},onShow(){let t=f(),a=e(),s={goods_id:0,url:a[a.length-1].route,platform:t.globalData.systemInfo.uniPlatform,model:t.globalData.systemInfo.deviceModel};this.$apis.visit.add(s),this.initData()},methods:{async initData(){let e,t=f(),a=this;await a.$onLaunched,a.theme=t.globalData.theme,e=await a.$apis.config.getShop(),a.shopConfig=e.data,e=await a.$apis.order.getData({id:a.currentID}),0==e.code?(a.refundState=e.data.is_refund,e.data.r_price=e.data.pay_price,parseInt(e.data.order_state_no)>2&&(e.data.r_price=(parseFloat(e.data.pay_price)-parseFloat(e.data.express_price)).toFixed(2)),1==parseInt(a.refundState)&&parseInt(e.data.refund_state)>0&&(a.refundState=-2),a.data=e.data):(a.refundState=-1,a.data={}),a.loading=!1},turnUrl(e="",n=1){e&&"#"!=e&&(1==n&&t({url:e}),2==n&&a({url:e}),3==n&&s({url:e}))},openType(){this.$refs.pickerType.open()},confirmType(e){let t=this;t.typeIndex=e.indexs[0],t.reasonIndex=0,0==t.typeIndex&&(t.reasonColumns=[["请选择"]]),1==t.typeIndex&&(t.reasonColumns[0]=t.shopConfig.refund_reason1,t.reasonColumns[0].unshift("请选择")),2==t.typeIndex&&(t.reasonColumns[0]=t.shopConfig.refund_reason2,t.reasonColumns[0].unshift("请选择"))},openReason(){this.$refs.pickerReason.open()},confirmReason(e){this.reasonIndex=e.indexs[0]},deletePic(e){this.fileList.splice(e.index,1)},async afterRead(e){let t=this,a=[].concat(e.file),s=t.fileList.length;a.map((e=>{t.fileList.push({...e,status:"uploading",message:"上传中"})}));for(let n=0;n<a.length;n++){const e=await this.$apis.upload.save({file:a[n].url,dir:"refund"});if(0==e.code){let a=t.fileList[s];t.fileList.splice(s,1,Object.assign(a,{status:"success",message:"",url:e.data.src,pic:e.data.file})),s++}}},onSubmit(){let e=this,t=n("formToken")||"";uni.$uv.throttle((function(){if(0==e.typeIndex)return void o({title:"请选择申请类型",icon:"none"});if(0==e.reasonIndex)return void o({title:"请选择退款原因",icon:"none"});let a=[];for(let t=0;t<e.fileList.length;t++)a.push(e.fileList[t].pic);l({title:"提交中"}),e.$apis.refund.saveData({form_token:t,id:e.currentID,type:e.typeIndex,reason:e.reasonColumns[0][e.reasonIndex],info:e.info,pic:a.join(",")}).then((e=>{i(),0==e.code?s({url:"/pages/refund/list"}):o({title:e.msg,icon:"none",duration:2e3})}))}))}}},[["render",function(e,t,a,s,n,o){const l=w(C("uv-loading-page"),D),i=p,f=v,S=w(C("uv-picker"),L),T=w(C("uv-icon"),j),F=w(C("uv-textarea"),R),P=w(C("uv-upload"),b),A=w(C("uv-empty"),$);return r(),d(i,{class:c(["content",n.theme])},{default:u((()=>[_(l,{loading:n.loading},null,8,["loading"]),n.loading?k("",!0):(r(),m(y,{key:0},[_(i,{class:"wrap"},{default:u((()=>[_(i,{class:"m_ctr"},{default:u((()=>[_(i,{class:"space_ctr"}),1==n.refundState?(r(),d(i,{key:0},{default:u((()=>[_(i,{class:"yuan_ctr"},{default:u((()=>[_(i,{class:"refund_title"},{default:u((()=>[g("退款商品")])),_:1}),(r(!0),m(y,null,h(n.data.goods_list,((e,a)=>(r(),d(i,{class:"order_goods_ctr",key:a,onClick:t[0]||(t[0]=e=>o.turnUrl("/pages/order/detail?id="+n.currentID))},{default:u((()=>[_(i,{class:"order_goods_pic"},{default:u((()=>[_(f,{mode:"widthFix",src:e.goods_pic},null,8,["src"])])),_:2},1024),_(i,{class:"order_goods_ctt"},{default:u((()=>[_(i,{class:"order_goods_title",style:I(""==e.spec_key_name?"-webkit-line-clamp:2;":"")},{default:u((()=>[g(x(e.goods_title),1)])),_:2},1032,["style"]),""!=e.spec_key_name?(r(),d(i,{key:0,class:"order_goods_subtitle"},{default:u((()=>[g(x(e.spec_key_name),1)])),_:2},1024)):k("",!0)])),_:2},1024),_(i,{class:"order_goods_price"},{default:u((()=>[_(i,null,{default:u((()=>[g("¥"+x(e.price),1)])),_:2},1024),_(i,null,{default:u((()=>[g("×"+x(e.amount),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),_(i,{class:"yuan_ctr"},{default:u((()=>[_(i,{class:"refund_title"},{default:u((()=>[g("退款信息")])),_:1}),_(i,{class:"input_ctr"},{default:u((()=>[_(i,{class:"input_title"},{default:u((()=>[g("申请类型")])),_:1}),_(i,{class:"input_right",onClick:t[1]||(t[1]=e=>o.openType())},{default:u((()=>[g(x(n.typeColumns[0][n.typeIndex])+" ",1),_(S,{ref:"pickerType",columns:n.typeColumns,onConfirm:o.confirmType},null,8,["columns","onConfirm"])])),_:1}),_(i,{class:"input_ico"},{default:u((()=>[_(T,{name:"arrow","custom-prefix":"custom-icon",color:"#ccc"})])),_:1})])),_:1}),_(i,{class:"input_ctr"},{default:u((()=>[_(i,{class:"input_title"},{default:u((()=>[g("退款原因")])),_:1}),_(i,{class:"input_right",onClick:t[2]||(t[2]=e=>o.openReason())},{default:u((()=>[g(x(n.reasonColumns[0][n.reasonIndex])+" ",1),_(S,{ref:"pickerReason",columns:n.reasonColumns,onConfirm:o.confirmReason},null,8,["columns","onConfirm"])])),_:1}),_(i,{class:"input_ico"},{default:u((()=>[_(T,{name:"arrow","custom-prefix":"custom-icon",color:"#ccc"})])),_:1})])),_:1}),n.data.r_price>0?(r(),m(y,{key:0},[_(i,{class:"input_ctr"},{default:u((()=>[_(i,{class:"input_title"},{default:u((()=>[g("退款金额")])),_:1}),_(i,{class:"input_right"},{default:u((()=>[_(i,{class:"span"},{default:u((()=>[g("¥"+x(n.data.r_price),1)])),_:1})])),_:1})])),_:1}),_(i,{class:"input_txt"},{default:u((()=>[g("不可修改，最多￥"+x(n.data.r_price)+"，含发货邮费￥"+x(n.data.express_price),1)])),_:1})],64)):k("",!0),n.data.exchange_integral>0?(r(),d(i,{key:1,class:"input_ctr"},{default:u((()=>[_(i,{class:"input_title"},{default:u((()=>[g("退还积分")])),_:1}),_(i,{class:"input_right"},{default:u((()=>[_(i,{class:"span"},{default:u((()=>[g(x(n.data.exchange_integral),1)])),_:1})])),_:1})])),_:1})):k("",!0)])),_:1}),_(i,{class:"yuan_ctr"},{default:u((()=>[_(i,{class:"refund_title"},{default:u((()=>[g("补充描述和凭证")])),_:1}),_(i,{class:"refund_info"},{default:u((()=>[_(F,{modelValue:n.info,"onUpdate:modelValue":t[3]||(t[3]=e=>n.info=e),placeholder:"补充描述，有助于商家更好的处理售后问题"},null,8,["modelValue"])])),_:1}),_(i,{class:"refund_pic"},{default:u((()=>[_(P,{fileList:n.fileList,multiple:"",maxCount:8,onAfterRead:o.afterRead,onDelete:o.deletePic},null,8,["fileList","onAfterRead","onDelete"])])),_:1})])),_:1})])),_:1})):k("",!0),-2==n.refundState?(r(),d(i,{key:1,class:"none_ctr"},{default:u((()=>[_(A,{icon:"/static/images/none.png",text:"订单已在退款中，管理员正在审核！"})])),_:1})):k("",!0),-1==n.refundState?(r(),d(i,{key:2,class:"none_ctr"},{default:u((()=>[_(A,{icon:"/static/images/none.png",text:"订单不存在"})])),_:1})):k("",!0),0==n.refundState?(r(),d(i,{key:3,class:"none_ctr"},{default:u((()=>[_(A,{icon:"/static/images/none.png",text:"订单不可退换或已过退换期"})])),_:1})):k("",!0)])),_:1}),_(i,{class:"space_footer"})])),_:1}),1==n.refundState?(r(),d(i,{key:0,class:"footer"},{default:u((()=>[_(i,{class:"footer_ctt"},{default:u((()=>[_(i,{class:"pay_btn",onClick:o.onSubmit},{default:u((()=>[g("确认提交")])),_:1},8,["onClick"])])),_:1})])),_:1})):k("",!0)],64))])),_:1},8,["class"])}],["__scopeId","data-v-a4da3d39"]]);export{T as default};
