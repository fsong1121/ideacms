import{g as e,n as t,d as a,r as s,H as n,A as o,a as l,h as i,e as r,o as d,f as u,w as c,i as f,j as p,k as _,l as m,p as g,q as y,F as h,t as x,v as k,u as C,C as I,x as v}from"./index-ozoT3Rek.js";import{_ as D}from"./uv-loading-page.tTreRwcr.js";import{_ as S,r as w}from"./uni-app.es.Cr4agT_b.js";import{_ as L}from"./uv-picker.MfjNbgon.js";import{_ as j}from"./uv-icon.uym7Qx1m.js";import{_ as R,a as b}from"./uv-upload.WNoR7pBf.js";import{_ as $}from"./uv-empty.pEbESuc9.js";import"./uv-popup.Da3LgW3S.js";const T=S({data:()=>({theme:"",loading:!0,currentID:0,refundState:-1,typeColumns:[["请选择","仅退款","退货退款"]],typeIndex:0,reasonColumns:[["请选择"]],reasonIndex:0,info:"",fileList:[],data:{},shopConfig:{}}),onLoad(e){let t=this;Reflect.ownKeys(e).length>0&&(t.currentID=e.hasOwnProperty("id")?e.id:0)},onShow(){let t=p(),a=e(),s={goods_id:0,url:a[a.length-1].route,platform:t.globalData.systemInfo.uniPlatform,model:t.globalData.systemInfo.deviceModel};this.$apis.visit.add(s),this.initData()},methods:{async initData(){let e,t=p(),a=this;await a.$onLaunched,a.theme=t.globalData.theme,e=await a.$apis.config.getShop(),a.shopConfig=e.data,e=await a.$apis.order.getData({id:a.currentID}),0==e.code?(a.refundState=e.data.is_refund,e.data.r_price=e.data.pay_price,parseInt(e.data.order_state_no)>2&&(e.data.r_price=(parseFloat(e.data.pay_price)-parseFloat(e.data.express_price)).toFixed(2)),1==parseInt(a.refundState)&&parseInt(e.data.refund_state)>0&&(a.refundState=-2),a.data=e.data):(a.refundState=-1,a.data={}),a.loading=!1},turnUrl(e="",n=1){e&&"#"!=e&&(1==n&&t({url:e}),2==n&&a({url:e}),3==n&&s({url:e}))},openType(){this.$refs.pickerType.open()},confirmType(e){let t=this;t.typeIndex=e.indexs[0],t.reasonIndex=0,0==t.typeIndex&&(t.reasonColumns=[["请选择"]]),1==t.typeIndex&&(t.reasonColumns[0]=t.shopConfig.refund_reason1,t.reasonColumns[0].unshift("请选择")),2==t.typeIndex&&(t.reasonColumns[0]=t.shopConfig.refund_reason2,t.reasonColumns[0].unshift("请选择"))},openReason(){this.$refs.pickerReason.open()},confirmReason(e){this.reasonIndex=e.indexs[0]},deletePic(e){this.fileList.splice(e.index,1)},async afterRead(e){let t=this,a=[].concat(e.file),s=t.fileList.length;a.map((e=>{t.fileList.push({...e,status:"uploading",message:"上传中"})}));for(let n=0;n<a.length;n++){const e=await this.$apis.upload.save({file:a[n].url,dir:"refund"});if(0==e.code){let a=t.fileList[s];t.fileList.splice(s,1,Object.assign(a,{status:"success",message:"",url:e.data.src,pic:e.data.file})),s++}}},onSubmit(){let e=this,t=n("formToken")||"";uni.$uv.throttle((function(){if(0==e.typeIndex)return void o({title:"请选择申请类型",icon:"none"});if(0==e.reasonIndex)return void o({title:"请选择退款原因",icon:"none"});let a=[];for(let t=0;t<e.fileList.length;t++)a.push(e.fileList[t].pic);l({title:"提交中"}),e.$apis.refund.saveData({form_token:t,id:e.currentID,type:e.typeIndex,reason:e.reasonColumns[0][e.reasonIndex],info:e.info,pic:a.join(",")}).then((e=>{i(),0==e.code?s({url:"/pages/refund/list"}):o({title:e.msg,icon:"none",duration:2e3})}))}))}}},[["render",function(e,t,a,s,n,o){const l=w(r("uv-loading-page"),D),i=_,p=v,S=w(r("uv-picker"),L),T=w(r("uv-icon"),j),F=w(r("uv-textarea"),R),P=w(r("uv-upload"),b),U=w(r("uv-empty"),$);return d(),u(i,{class:f(["content",n.theme])},{default:c((()=>[m(l,{loading:n.loading},null,8,["loading"]),n.loading?C("",!0):(d(),g(h,{key:0},[m(i,{class:"wrap"},{default:c((()=>[m(i,{class:"m_ctr"},{default:c((()=>[m(i,{class:"space_ctr"}),1==n.refundState?(d(),u(i,{key:0},{default:c((()=>[m(i,{class:"yuan_ctr"},{default:c((()=>[m(i,{class:"refund_title"},{default:c((()=>[y("退款商品")])),_:1}),(d(!0),g(h,null,x(n.data.goods_list,((e,a)=>(d(),u(i,{class:"order_goods_ctr",key:a,onClick:t[0]||(t[0]=e=>o.turnUrl("/pages/order/detail?id="+n.currentID))},{default:c((()=>[m(i,{class:"order_goods_pic"},{default:c((()=>[m(p,{mode:"widthFix",src:e.goods_pic},null,8,["src"])])),_:2},1024),m(i,{class:"order_goods_ctt"},{default:c((()=>[m(i,{class:"order_goods_title",style:I(""==e.spec_key_name?"-webkit-line-clamp:2;":"")},{default:c((()=>[y(k(e.goods_title),1)])),_:2},1032,["style"]),""!=e.spec_key_name?(d(),u(i,{key:0,class:"order_goods_subtitle"},{default:c((()=>[y(k(e.spec_key_name),1)])),_:2},1024)):C("",!0)])),_:2},1024),m(i,{class:"order_goods_price"},{default:c((()=>[m(i,null,{default:c((()=>[y("¥"+k(e.price),1)])),_:2},1024),m(i,null,{default:c((()=>[y("×"+k(e.amount),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),m(i,{class:"yuan_ctr"},{default:c((()=>[m(i,{class:"refund_title"},{default:c((()=>[y("退款信息")])),_:1}),m(i,{class:"input_ctr"},{default:c((()=>[m(i,{class:"input_title"},{default:c((()=>[y("申请类型")])),_:1}),m(i,{class:"input_right",onClick:t[1]||(t[1]=e=>o.openType())},{default:c((()=>[y(k(n.typeColumns[0][n.typeIndex])+" ",1),m(S,{ref:"pickerType",columns:n.typeColumns,onConfirm:o.confirmType},null,8,["columns","onConfirm"])])),_:1}),m(i,{class:"input_ico"},{default:c((()=>[m(T,{name:"arrow","custom-prefix":"custom-icon",color:"#ccc"})])),_:1})])),_:1}),m(i,{class:"input_ctr"},{default:c((()=>[m(i,{class:"input_title"},{default:c((()=>[y("退款原因")])),_:1}),m(i,{class:"input_right",onClick:t[2]||(t[2]=e=>o.openReason())},{default:c((()=>[y(k(n.reasonColumns[0][n.reasonIndex])+" ",1),m(S,{ref:"pickerReason",columns:n.reasonColumns,onConfirm:o.confirmReason},null,8,["columns","onConfirm"])])),_:1}),m(i,{class:"input_ico"},{default:c((()=>[m(T,{name:"arrow","custom-prefix":"custom-icon",color:"#ccc"})])),_:1})])),_:1}),n.data.r_price>0?(d(),g(h,{key:0},[m(i,{class:"input_ctr"},{default:c((()=>[m(i,{class:"input_title"},{default:c((()=>[y("退款金额")])),_:1}),m(i,{class:"input_right"},{default:c((()=>[m(i,{class:"span"},{default:c((()=>[y("¥"+k(n.data.r_price),1)])),_:1})])),_:1})])),_:1}),m(i,{class:"input_txt"},{default:c((()=>[y("不可修改，最多￥"+k(n.data.r_price)+"，含发货邮费￥"+k(n.data.express_price),1)])),_:1})],64)):C("",!0),n.data.exchange_integral>0?(d(),u(i,{key:1,class:"input_ctr"},{default:c((()=>[m(i,{class:"input_title"},{default:c((()=>[y("退还积分")])),_:1}),m(i,{class:"input_right"},{default:c((()=>[m(i,{class:"span"},{default:c((()=>[y(k(n.data.exchange_integral),1)])),_:1})])),_:1})])),_:1})):C("",!0)])),_:1}),m(i,{class:"yuan_ctr"},{default:c((()=>[m(i,{class:"refund_title"},{default:c((()=>[y("补充描述和凭证")])),_:1}),m(i,{class:"refund_info"},{default:c((()=>[m(F,{modelValue:n.info,"onUpdate:modelValue":t[3]||(t[3]=e=>n.info=e),placeholder:"补充描述，有助于商家更好的处理售后问题"},null,8,["modelValue"])])),_:1}),m(i,{class:"refund_pic"},{default:c((()=>[m(P,{fileList:n.fileList,multiple:"",maxCount:8,onAfterRead:o.afterRead,onDelete:o.deletePic},null,8,["fileList","onAfterRead","onDelete"])])),_:1})])),_:1})])),_:1})):C("",!0),-2==n.refundState?(d(),u(i,{key:1,class:"none_ctr"},{default:c((()=>[m(U,{icon:"/static/images/none.png",text:"订单已在退款中，管理员正在审核！"})])),_:1})):C("",!0),-1==n.refundState?(d(),u(i,{key:2,class:"none_ctr"},{default:c((()=>[m(U,{icon:"/static/images/none.png",text:"订单不存在"})])),_:1})):C("",!0),0==n.refundState?(d(),u(i,{key:3,class:"none_ctr"},{default:c((()=>[m(U,{icon:"/static/images/none.png",text:"订单不可退换或已过退换期"})])),_:1})):C("",!0)])),_:1}),m(i,{class:"space_footer"})])),_:1}),1==n.refundState?(d(),u(i,{key:0,class:"footer"},{default:c((()=>[m(i,{class:"footer_ctt"},{default:c((()=>[m(i,{class:"pay_btn",onClick:o.onSubmit},{default:c((()=>[y("确认提交")])),_:1},8,["onClick"])])),_:1})])),_:1})):C("",!0)],64))])),_:1},8,["class"])}],["__scopeId","data-v-a4da3d39"]]);export{T as default};
