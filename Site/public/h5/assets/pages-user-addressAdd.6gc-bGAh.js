import{g as e,H as a,A as t,a as s,h as i,n as l,e as n,f as r,w as o,i as u,j as c,k as d,o as h,l as f,q as p,v as m,u as _,M as v,N as g,O as k}from"./index-CGszr9qB.js";import{_ as V}from"./uv-loading-page.DMunDfme.js";import{_ as y,r as C}from"./uni-app.es.CLj63pkI.js";import{_ as b}from"./uv-picker.CDdUMcVA.js";import{_ as D}from"./uv-switch.GSEINgNo.js";import"./uv-popup.DxYpcAeE.js";import"./uv-icon.40j6Cb1z.js";const x=y({data:()=>({theme:"",themeColor:"",loading:!0,provinces:[],citys:[],areas:[],pickerValue:[0,0,0],defaultValue:["北京市","北京市","东城区"],areaStr:"北京市 北京市 东城区",isDefault:!1}),onShow(){let a=c(),t=e(),s={goods_id:0,url:t[t.length-1].route,platform:a.globalData.systemInfo.uniPlatform,model:a.globalData.systemInfo.deviceModel};this.$apis.visit.add(s),this.initData()},computed:{addressList(){return[this.provinces,this.citys,this.areas]}},methods:{async initData(){let e,a=c(),t=this;await t.$onLaunched,t.theme=a.globalData.theme,t.themeColor=a.globalData.themeColor,e=await t.$apis.address.getArea(),t.provinces=e.data,t.loading=!1},handlePickValueDefault(){var e,a;this.pickerValue[0]=this.provinces.findIndex((e=>e.name===this.defaultValue[0])),this.citys=(null==(e=this.provinces[this.pickerValue[0]])?void 0:e.children)||[],this.pickerValue[1]=this.citys.findIndex((e=>e.name===this.defaultValue[1])),this.areas=(null==(a=this.citys[this.pickerValue[1]])?void 0:a.children)||[],this.pickerValue[2]=this.areas.findIndex((e=>e.name===this.defaultValue[2])),this.$refs.picker.setIndexs([this.pickerValue[0],this.pickerValue[1],this.pickerValue[2]],!0)},changeArea(e){var a,t,s;if(this.loading)return;const{columnIndex:i,index:l,indexs:n}=e;0===i?(this.citys=(null==(a=this.provinces[l])?void 0:a.children)||[],this.areas=(null==(t=this.citys[0])?void 0:t.children)||[],this.$refs.picker.setIndexs([l,0,0],!0)):1===i&&(this.areas=(null==(s=this.citys[l])?void 0:s.children)||[],this.$refs.picker.setIndexs(n,!0))},openArea(){this.$refs.picker.open(),this.handlePickValueDefault()},confirmArea(e){let a=this;a.defaultValue[0]=e.value[0].name,a.defaultValue[1]=e.value[1].name,a.defaultValue[2]=e.value[2].name,a.areaStr=e.value[0].name+" "+e.value[1].name+" "+e.value[2].name},onChange(e){this.isDefault=e},formSubmit(e){let n=this,r=e.detail.value;r.province=n.defaultValue[0],r.city=n.defaultValue[1],r.county=n.defaultValue[2],r.form_token=a("formToken")||"",r.is_default=n.isDefault?1:0,uni.$uv.throttle((function(){let e=r.name.replace(/\s/g,""),a=r.tel.replace(/\s/g,""),o=r.address.replace(/\s/g,"");""!=r.province&&""!=r.city&&""!=r.county?""!=o?""!=e?uni.$uv.test.mobile(a)?(s({title:"提交中"}),n.$apis.address.saveData(r).then((e=>{i(),0==e.code?l({url:"/pages/user/address"}):t({title:e.msg,icon:"none",duration:2e3})}))):t({title:"手机号错误",icon:"error"}):t({title:"联系人为空",icon:"error"}):t({title:"详细地址为空",icon:"error"}):t({title:"请选择所在地区",icon:"error"})}))}}},[["render",function(e,a,t,s,i,l){const c=C(n("uv-loading-page"),V),y=d,x=C(n("uv-picker"),b),I=v,$=C(n("uv-switch"),D),j=g,A=k;return h(),r(y,{class:u(["content",i.theme])},{default:o((()=>[f(c,{loading:i.loading},null,8,["loading"]),i.loading?_("",!0):(h(),r(A,{key:0,onSubmit:l.formSubmit},{default:o((()=>[f(y,{class:"wrap"},{default:o((()=>[f(y,{class:"m_ctr"},{default:o((()=>[f(y,{class:"space_ctr"}),f(y,{class:"yuan_ctr"},{default:o((()=>[f(y,{class:"input_ctr"},{default:o((()=>[f(y,{class:"input_title"},{default:o((()=>[p("所在地区")])),_:1}),f(y,{class:"txt",onClick:l.openArea},{default:o((()=>[p(m(i.areaStr),1)])),_:1},8,["onClick"]),f(x,{ref:"picker",columns:l.addressList,loading:i.loading,keyName:"name",onChange:l.changeArea,onConfirm:l.confirmArea},null,8,["columns","loading","onChange","onConfirm"])])),_:1}),f(y,{class:"input_ctr"},{default:o((()=>[f(y,{class:"input_title"},{default:o((()=>[p("详细地址")])),_:1}),f(I,{name:"address",placeholder:"街道、门牌号等"})])),_:1}),f(y,{class:"input_ctr"},{default:o((()=>[f(y,{class:"input_title"},{default:o((()=>[p("收货人")])),_:1}),f(I,{name:"name",placeholder:"收货人姓名"})])),_:1}),f(y,{class:"input_ctr",style:{border:"0"}},{default:o((()=>[f(y,{class:"input_title"},{default:o((()=>[p("手机号")])),_:1}),f(I,{name:"tel",type:"number",placeholder:"11位手机号码"})])),_:1})])),_:1}),f(y,{class:"yuan_ctr"},{default:o((()=>[f(y,{class:"input_ctr",style:{border:"0"}},{default:o((()=>[f(y,{class:"input_title"},{default:o((()=>[p("设为默认")])),_:1}),f(y,{class:"input_right"},{default:o((()=>[f($,{modelValue:i.isDefault,"onUpdate:modelValue":a[0]||(a[0]=e=>i.isDefault=e),size:"22",activeColor:i.themeColor,inactiveColor:"#f6f6f6",onChange:l.onChange},null,8,["modelValue","activeColor","onChange"])])),_:1})])),_:1})])),_:1}),f(j,{class:"address_btn","form-type":"submit"},{default:o((()=>[p("保存")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"]))])),_:1},8,["class"])}],["__scopeId","data-v-2ecd23b4"]]);export{x as default};
