import{g as e,H as a,A as t,a as s,h as l,n as i,B as n,r,o as u,e as d,w as o,f as c,i as f,j as h,k as p,p as m,u as _,t as v,v as g,M as y,N as k,O as V}from"./index-61bca09a.js";import{_ as D}from"./uv-loading-page.a3cea9e4.js";import{_ as C,r as b}from"./uni-app.es.c541313a.js";import{_ as I}from"./uv-picker.53a1b296.js";import{_ as x}from"./uv-switch.b004d6f2.js";import"./uv-popup.0cc007cb.js";import"./uv-icon.06d9cba4.js";const $=C({data:()=>({theme:"",themeColor:"",loading:!0,currentID:0,data:{},provinces:[],citys:[],areas:[],pickerValue:[0,0,0],defaultValue:["北京市","北京市","东城区"],areaStr:"北京市 北京市 东城区",isDefault:!1}),onLoad(e){let a=this;Reflect.ownKeys(e).length>0&&e.hasOwnProperty("id")&&(a.currentID=e.id)},onShow(){let a=f(),t=e(),s={goods_id:0,url:t[t.length-1].route,platform:a.globalData.systemInfo.uniPlatform,model:a.globalData.systemInfo.deviceModel};this.$apis.visit.add(s),this.initData()},computed:{addressList(){return[this.provinces,this.citys,this.areas]}},methods:{async initData(){let e,a=f(),t=this;await t.$onLaunched,t.theme=a.globalData.theme,t.themeColor=a.globalData.themeColor,e=await t.$apis.address.getData({id:t.currentID}),0==e.code&&(t.data=e.data,t.defaultValue[0]=e.data.province,t.defaultValue[1]=e.data.city,t.defaultValue[2]=e.data.county,t.areaStr=e.data.province+" "+e.data.city+" "+e.data.county,t.isDefault=!!e.is_default),e=await t.$apis.address.getArea(),t.provinces=e.data,t.loading=!1},handlePickValueDefault(){var e,a;this.pickerValue[0]=this.provinces.findIndex((e=>e.name===this.defaultValue[0])),this.citys=(null==(e=this.provinces[this.pickerValue[0]])?void 0:e.children)||[],this.pickerValue[1]=this.citys.findIndex((e=>e.name===this.defaultValue[1])),this.areas=(null==(a=this.citys[this.pickerValue[1]])?void 0:a.children)||[],this.pickerValue[2]=this.areas.findIndex((e=>e.name===this.defaultValue[2])),this.$refs.picker.setIndexs([this.pickerValue[0],this.pickerValue[1],this.pickerValue[2]],!0)},changeArea(e){var a,t,s;if(this.loading)return;const{columnIndex:l,index:i,indexs:n}=e;0===l?(this.citys=(null==(a=this.provinces[i])?void 0:a.children)||[],this.areas=(null==(t=this.citys[0])?void 0:t.children)||[],this.$refs.picker.setIndexs([i,0,0],!0)):1===l&&(this.areas=(null==(s=this.citys[i])?void 0:s.children)||[],this.$refs.picker.setIndexs(n,!0))},openArea(){this.$refs.picker.open(),this.handlePickValueDefault()},confirmArea(e){let a=this;a.defaultValue[0]=e.value[0].name,a.defaultValue[1]=e.value[1].name,a.defaultValue[2]=e.value[2].name,a.areaStr=e.value[0].name+" "+e.value[1].name+" "+e.value[2].name},onChange(e){this.isDefault=e},formSubmit(e){let n=this,r=e.detail.value;r.province=n.defaultValue[0],r.city=n.defaultValue[1],r.county=n.defaultValue[2],r.form_token=a("formToken")||"",r.is_default=n.isDefault?1:0,r.m_id=n.currentID,uni.$uv.throttle((function(){let e=r.name.replace(/\s/g,""),a=r.tel.replace(/\s/g,""),u=r.address.replace(/\s/g,"");""!=r.province&&""!=r.city&&""!=r.county?""!=u?""!=e?uni.$uv.test.mobile(a)?(s({title:"提交中"}),n.$apis.address.saveData(r).then((e=>{l(),0==e.code?i({url:"/pages/user/address"}):t({title:e.msg,icon:"none",duration:2e3})}))):t({title:"手机号错误",icon:"error"}):t({title:"联系人为空",icon:"error"}):t({title:"详细地址为空",icon:"error"}):t({title:"请选择所在地区",icon:"error"})}))},delAddress(){let e=this;n({title:"提示",content:"确认要删除吗？",success(a){a.confirm&&e.$apis.address.deleteData({id:e.currentID}).then((e=>{0==e.code?r({url:"/pages/user/address"}):console.log(e.msg)}))}})}}},[["render",function(e,a,t,s,l,i){const n=b(g("uv-loading-page"),D),r=h,f=b(g("uv-picker"),I),C=y,$=b(g("uv-switch"),x),w=k,A=V;return u(),d(r,{class:c(["content",l.theme])},{default:o((()=>[p(n,{loading:l.loading},null,8,["loading"]),l.loading?v("",!0):(u(),d(A,{key:0,onSubmit:i.formSubmit},{default:o((()=>[p(r,{class:"wrap"},{default:o((()=>[p(r,{class:"m_ctr"},{default:o((()=>[p(r,{class:"space_ctr"}),p(r,{class:"yuan_ctr"},{default:o((()=>[p(r,{class:"input_ctr"},{default:o((()=>[p(r,{class:"input_title"},{default:o((()=>[m("所在地区")])),_:1}),p(r,{class:"txt",onClick:i.openArea},{default:o((()=>[m(_(l.areaStr),1)])),_:1},8,["onClick"]),p(f,{ref:"picker",columns:i.addressList,loading:l.loading,keyName:"name",onChange:i.changeArea,onConfirm:i.confirmArea},null,8,["columns","loading","onChange","onConfirm"])])),_:1}),p(r,{class:"input_ctr"},{default:o((()=>[p(r,{class:"input_title"},{default:o((()=>[m("详细地址")])),_:1}),p(C,{name:"address",value:l.data.address,placeholder:"街道、门牌号等"},null,8,["value"])])),_:1}),p(r,{class:"input_ctr"},{default:o((()=>[p(r,{class:"input_title"},{default:o((()=>[m("收货人")])),_:1}),p(C,{name:"name",value:l.data.name,placeholder:"收货人姓名"},null,8,["value"])])),_:1}),p(r,{class:"input_ctr",style:{border:"0"}},{default:o((()=>[p(r,{class:"input_title"},{default:o((()=>[m("手机号")])),_:1}),p(C,{name:"tel",value:l.data.tel,type:"number",placeholder:"11位手机号码"},null,8,["value"])])),_:1})])),_:1}),p(r,{class:"yuan_ctr"},{default:o((()=>[p(r,{class:"input_ctr",style:{border:"0"}},{default:o((()=>[p(r,{class:"input_title"},{default:o((()=>[m("设为默认")])),_:1}),p(r,{class:"input_right"},{default:o((()=>[p($,{modelValue:l.isDefault,"onUpdate:modelValue":a[0]||(a[0]=e=>l.isDefault=e),size:"22",activeColor:l.themeColor,inactiveColor:"#f6f6f6",onChange:i.onChange},null,8,["modelValue","activeColor","onChange"])])),_:1})])),_:1})])),_:1}),p(w,{class:"address_btn","form-type":"submit"},{default:o((()=>[m("保存")])),_:1}),p(w,{class:"address_btn_del",onClick:i.delAddress},{default:o((()=>[m("删除地址")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["onSubmit"]))])),_:1},8,["class"])}],["__scopeId","data-v-ecd7fc7f"]]);export{$ as default};
