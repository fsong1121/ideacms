var e,t;import{E as n,G as i,H as s,I as a,J as o,o as l,e as u,j as r,g as c,D as d,A as h,a as g,h as m,K as p,d as f,L as _,n as v,r as b,w as y,f as C,C as k,i as T,k as x,p as I,t as N,u as S,M as D,N as L,O as $,v as w}from"./index-8b182b74.js";import{_ as E,r as H}from"./uni-app.es.90f08a56.js";import{_ as A,a as K}from"./uv-checkbox-group.02ff197e.js";import"./uv-icon.70699d37.js";const G=E({name:"uv-code",mixins:[n,i,{props:{seconds:{type:[String,Number],default:60},startText:{type:String,default:"获取验证码"},changeText:{type:String,default:"X秒重新获取"},endText:{type:String,default:"重新获取"},keepRunning:{type:Boolean,default:!1},uniqueKey:{type:String,default:""},...null==(t=null==(e=uni.$uv)?void 0:e.props)?void 0:t.code}}],data(){return{secNum:this.seconds,timer:null,canGetCode:!0}},mounted(){this.checkKeepRunning()},watch:{seconds:{immediate:!0,handler(e){this.secNum=e}}},methods:{checkKeepRunning(){let e=Number(s(this.uniqueKey+"_$uCountDownTimestamp"));if(!e)return this.changeEvent(this.startText);let t=Math.floor(+new Date/1e3);this.keepRunning&&e&&e>t?(this.secNum=e-t,a(this.uniqueKey+"_$uCountDownTimestamp"),this.start()):this.changeEvent(this.startText)},start(){this.timer&&(clearInterval(this.timer),this.timer=null),this.$emit("start"),this.canGetCode=!1,this.changeEvent(this.changeText.replace(/x|X/,this.secNum)),this.timer=setInterval((()=>{--this.secNum?this.changeEvent(this.changeText.replace(/x|X/,this.secNum)):(clearInterval(this.timer),this.timer=null,this.changeEvent(this.endText),this.secNum=this.seconds,this.$emit("end"),this.canGetCode=!0)}),1e3),this.setTimeToStorage()},reset(){this.canGetCode=!0,clearInterval(this.timer),this.secNum=this.seconds,this.changeEvent(this.endText)},changeEvent(e){this.$emit("change",e)},setTimeToStorage(){if(this.keepRunning&&this.timer&&this.secNum>0&&this.secNum<=this.seconds){let e=Math.floor(+new Date/1e3);o({key:this.uniqueKey+"_$uCountDownTimestamp",data:e+Number(this.secNum)})}}},unmounted(){this.setTimeToStorage(),clearTimeout(this.timer),this.timer=null}},[["render",function(e,t,n,i,s,a){const o=r;return l(),u(o,{class:"uv-code"})}]]);const M=E({data:()=>({theme:"",themeColor:"",curLogin:0,smsLogin:0,otherLogin:0,tips:"",seconds:60,sending:0,tel:"",code:"",isAgree:0,backgroundStyle:{},navHeight:0,customNavWidth:0,customNavHeight:0,customNavTop:0}),onLoad(e){this.initData()},onShow(){let e=T(),t=c(),n={goods_id:0,url:t[t.length-1].route,platform:e.globalData.systemInfo.uniPlatform,model:e.globalData.systemInfo.deviceModel};this.$apis.visit.add(n)},methods:{async initData(){let e=T(),t=this;await t.$onLaunched,t.theme=e.globalData.theme,t.themeColor=e.globalData.themeColor,t.smsLogin=e.globalData.siteInfo.code_login,t.otherLogin=e.globalData.siteInfo.other_login,t.curLogin=e.globalData.siteInfo.other_login;let n=0,i=0;Reflect.ownKeys(e.globalData.systemInfo).length>0&&(n=e.globalData.systemInfo.statusBarHeight,i=e.globalData.systemInfo.navHeight,t.navHeight=i,t.customNavWidth=e.globalData.systemInfo.boundingLeft,t.customNavHeight=e.globalData.systemInfo.boundingHeight,t.customNavTop=e.globalData.systemInfo.boundingTop);let s=-260;s=parseInt(s)+Number(parseInt((i+n)/(d(100)/100))),t.backgroundStyle={background:"url("+e.globalData.siteInfo.url+"/upload/pic/public/m_bg_"+e.globalData.theme+".png) left "+s+"rpx no-repeat #f6f6f6",backgroundSize:"100% auto"}},checkAgree(e){this.isAgree=e.length},changeLogin(){this.curLogin=0==this.curLogin?1:0},formSubmit(e){let t=this,n=t.isAgree;uni.$uv.throttle((function(i=e.detail.value){let a=c();if(!n)return void h({title:"请同意用户协议",icon:"none",duration:2e3});if(""==i.m_uid||""==i.m_pwd)return void h({title:"用户名或密码为空",icon:"none",duration:2e3});let o=s("pid")||"";""==o&&(o=0),g({title:"登录中"});let l={m_uid:i.m_uid,m_pwd:i.m_pwd,pid:o};t.$apis.login.login(l).then((e=>{m(),0==e.code?a.length>1?p({delta:1}):f({url:"/pages/user/index"}):h({title:e.msg,icon:"none",duration:2e3})}))}))},inputTel(e){this.tel=e.detail.value},inputCode(e){this.code=e.detail.value},codeChange(e){this.tips=e},getCode(){let e=this;uni.$uv.throttle((function(){let t=e.tel;if(e.$refs.code.canGetCode){if(!uni.$uv.test.mobile(t))return void h({title:"手机号错误",icon:"error"});g({title:"正在获取验证码"});let n={m_tel:t};e.$apis.login.sendSmsCode(n).then((t=>{0==t.code?(m(),h({title:"验证码已发送",icon:"none"}),e.$refs.code.start()):h({title:t.message,icon:"none"})}))}}))},end(){this.sending=0},start(){this.sending=1},smsSubmit(e){let t=this,n=t.isAgree;uni.$uv.throttle((function(i=e.detail.value){let a=c();if(!n)return void h({title:"请同意用户协议",icon:"none",duration:2e3});if(""==i.m_tel||""==i.m_tel)return void h({title:"手机号或验证码为空！",icon:"none",duration:2e3});let o=s("pid")||"";""==o&&(o=0),g({title:"登录中"});let l={m_tel:i.m_tel,m_code:i.m_code,pid:o};t.$apis.login.smsCodeLogin(l).then((e=>{m(),0==e.code?a.length>1?p({delta:1}):f({url:"/pages/user/index"}):h({title:e.msg,icon:"none",duration:2e3})}))}))},getPhoneNumber(e){let t=this,n=c();if(t.isAgree){if("getPhoneNumber:ok"==e.detail.errMsg){let i=e.detail.code,a="";_({provider:"weixin",success:function(e){"login:ok"==e.errMsg&&(a=e.code);let o=s("pid")||"";""==o&&(o=0),g({title:"登录中"});let l={loginCode:a,phoneCode:i,pid:o};t.$apis.login.miniappLogin(l).then((e=>{m(),0==e.code?n.length>1?p({delta:1}):f({url:"/pages/user/index"}):h({title:e.msg,icon:"none",duration:2e3})}))}})}}else h({title:"请同意用户协议",icon:"none",duration:2e3})},wechatLogin(){},goBack(){f({url:"/pages/index/index"})},turnUrl(e="",t=1){e&&"#"!=e&&(1==t&&v({url:e}),2==t&&f({url:e}),3==t&&b({url:e}))}}},[["render",function(e,t,n,i,s,a){const o=r,c=D,d=L,h=$,g=H(w("uv-code"),G),m=H(w("uv-checkbox"),A),p=H(w("uv-checkbox-group"),K);return l(),u(o,{class:C(["content",s.theme]),style:k(s.backgroundStyle)},{default:y((()=>[x(o,{class:"wrap"},{default:y((()=>[x(o,{class:"status_bar",style:k({paddingTop:s.navHeight+"px"})},null,8,["style"]),x(o,{class:"login_top"},{default:y((()=>[x(o,null,{default:y((()=>[I("欢迎您，")])),_:1}),x(o,null,{default:y((()=>[I("亲爱的家人们！")])),_:1})])),_:1}),x(o,{class:"m_ctr"},{default:y((()=>[x(o,{class:"yuan_ctr"},{default:y((()=>[0==s.curLogin?(l(),u(h,{key:0,onSubmit:a.formSubmit},{default:y((()=>[x(o,{class:"input_title"},{default:y((()=>[I("账号：")])),_:1}),x(o,{class:"input_ctr"},{default:y((()=>[x(c,{name:"m_uid",placeholder:"请输入用户名/手机号"})])),_:1}),x(o,{class:"input_title"},{default:y((()=>[I("密码：")])),_:1}),x(o,{class:"input_ctr"},{default:y((()=>[x(c,{name:"m_pwd",password:"true",placeholder:"请输入密码"})])),_:1}),1==s.smsLogin?(l(),u(o,{key:0,class:"login_type",onClick:a.changeLogin},{default:y((()=>[I("手机验证码登录")])),_:1},8,["onClick"])):N("",!0),x(d,{class:"login_btn",formType:"submit"},{default:y((()=>[I("立即登录")])),_:1})])),_:1},8,["onSubmit"])):N("",!0),1==s.curLogin?(l(),u(h,{key:1,onSubmit:a.smsSubmit},{default:y((()=>[x(o,{class:"input_title"},{default:y((()=>[I("手机号：")])),_:1}),x(o,{class:"input_ctr"},{default:y((()=>[x(c,{name:"m_tel",type:"number",onInput:a.inputTel,placeholder:"请输入11位手机号"},null,8,["onInput"])])),_:1}),x(o,{class:"input_title"},{default:y((()=>[I("验证码：")])),_:1}),x(o,{class:"input_ctr"},{default:y((()=>[x(o,{class:"get_code_ctr"},{default:y((()=>[x(g,{seconds:s.seconds,onEnd:a.end,onStart:a.start,ref:"code",onChange:a.codeChange},null,8,["seconds","onEnd","onStart","onChange"]),x(o,{class:C(0==s.sending?"get_code_btn":"get_code_btn_on"),onClick:a.getCode},{default:y((()=>[I(S(s.tips),1)])),_:1},8,["class","onClick"])])),_:1}),x(c,{name:"m_code",type:"number",onInput:a.inputCode,placeholder:"请输入验证码"},null,8,["onInput"])])),_:1}),x(o,{class:"login_type",onClick:a.changeLogin},{default:y((()=>[I("账号登录")])),_:1},8,["onClick"]),x(d,{class:"login_btn",formType:"submit"},{default:y((()=>[I("立即登录")])),_:1})])),_:1},8,["onSubmit"])):N("",!0),x(o,{class:"agree_ctr"},{default:y((()=>[x(o,{class:"agree_ctt"},{default:y((()=>[x(p,{shape:"circle",size:"14",activeColor:s.themeColor,onChange:a.checkAgree},{default:y((()=>[x(m,{name:"agree"})])),_:1},8,["activeColor","onChange"]),x(o,null,{default:y((()=>[I("我已阅读并同意")])),_:1}),x(o,{onClick:t[0]||(t[0]=e=>a.turnUrl("/pages/article/agreement?type=user"))},{default:y((()=>[I("《用户协议》")])),_:1}),x(o,{onClick:t[1]||(t[1]=e=>a.turnUrl("/pages/article/agreement?type=privacy"))},{default:y((()=>[I("《隐私协议》")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class","style"])}],["__scopeId","data-v-53f28356"]]);export{M as default};
