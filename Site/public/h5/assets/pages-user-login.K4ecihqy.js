import{g as e,s as t,D as a,A as l,E as n,a as o,h as i,d as s,r,G as u,n as c,e as d,f as g,w as m,i as f,C as _,j as p,k as h,o as b,l as v,q as x,u as y,v as k,I as C,H as L,J as I}from"./index-qqngRkUa.js";import{_ as D,a as S}from"./uv-code.BIZvydD6.js";import{_ as $,r as w}from"./uni-app.es.DMzxE133.js";import{_ as U,a as H}from"./uv-checkbox-group.CE1ooxHf.js";import{_ as V}from"./uv-divider.DZeIP-Lg.js";import{_ as A}from"./uv-icon.BH_bzOnD.js";const N=$({data:()=>({theme:"",themeColor:"",curLogin:0,smsLogin:0,otherLogin:0,tips:"",seconds:60,sending:0,tel:"",isAgree:1,checkboxValue:["agree"],backgroundStyle:{},navHeight:0,customNavWidth:0,customNavHeight:0,customNavTop:0}),onLoad(a){let l=e();l.length>1&&(t("prevUrl",l[l.length-2].$page.fullPath),l.length>2&&l[l.length-2].$page.fullPath.indexOf("/user/login")>0&&t("prevUrl",l[l.length-3].$page.fullPath)),this.initData()},onShow(){let t=p(),a=e(),l={goods_id:0,url:a[a.length-1].route,platform:t.globalData.systemInfo.uniPlatform,model:t.globalData.systemInfo.deviceModel};this.$apis.visit.add(l)},methods:{async initData(){let e=p(),t=this;await t.$onLaunched,t.theme=e.globalData.theme,t.themeColor=e.globalData.themeColor,t.smsLogin=e.globalData.siteInfo.code_login,t.otherLogin=e.globalData.siteInfo.other_login;let l=0,n=0;Reflect.ownKeys(e.globalData.systemInfo).length>0&&(l=e.globalData.systemInfo.statusBarHeight,n=e.globalData.systemInfo.navHeight,t.navHeight=n,t.customNavWidth=e.globalData.systemInfo.boundingLeft,t.customNavHeight=e.globalData.systemInfo.boundingHeight,t.customNavTop=e.globalData.systemInfo.boundingTop);let o=-260;o=parseInt(o)+Number(parseInt((n+l)/(a(100)/100))),t.backgroundStyle={background:"url("+e.globalData.siteInfo.url+"/upload/pic/public/m_bg_"+e.globalData.theme+".png) left "+o+"rpx no-repeat #f6f6f6",backgroundSize:"100% auto"}},checkAgree(e){this.isAgree=e.length},changeLogin(){this.curLogin=0==this.curLogin?1:0},formSubmit(e){let t=this,a=t.isAgree;uni.$uv.throttle((function(u=e.detail.value){if(!a)return void l({title:"请同意用户协议",icon:"none",duration:2e3});if(""==u.m_uid||""==u.m_pwd)return void l({title:"用户名或密码为空",icon:"none",duration:2e3});if(!t.$refs.captcha.verification(u.m_code))return void l({title:"验证码错误",icon:"none",duration:2e3});let c=n("pid")||"";""==c&&(c=0),o({title:"登录中"});let d={m_uid:u.m_uid,m_pwd:u.m_pwd,m_code:u.m_code,pid:c};t.$apis.login.login(d).then((e=>{if(i(),0==e.code){let e=n("prevUrl")||"/pages/user/index";e.indexOf("/cart/index")>0||e.indexOf("/user/index")>0?s({url:e}):r({url:e})}else l({title:e.msg,icon:"none",duration:2e3})}))}))},inputTel(e){this.tel=e.detail.value},codeChange(e){this.tips=e},getCode(){let e=this;uni.$uv.throttle((function(){let t=e.tel;if(e.$refs.code.canGetCode){if(!uni.$uv.test.mobile(t))return void l({title:"手机号错误",icon:"error"});o({title:"正在获取验证码"});let a={m_tel:t};e.$apis.login.sendSmsCode(a).then((t=>{0==t.code?(i(),l({title:"验证码已发送",icon:"none"}),e.$refs.code.start()):l({title:t.message,icon:"none"})}))}}))},end(){this.sending=0},start(){this.sending=1},smsSubmit(e){let t=this,a=t.isAgree;uni.$uv.throttle((function(u=e.detail.value){if(!a)return void l({title:"请同意用户协议",icon:"none",duration:2e3});if(""==u.m_tel||""==u.m_tel)return void l({title:"手机号或验证码为空！",icon:"none",duration:2e3});let c=n("pid")||"";""==c&&(c=0),o({title:"登录中"});let d={m_tel:u.m_tel,m_code:u.m_code,pid:c};t.$apis.login.smsCodeLogin(d).then((e=>{if(i(),0==e.code){let e=n("prevUrl")||"/pages/user/index";e.indexOf("/cart/index")>0||e.indexOf("/user/index")>0?s({url:e}):r({url:e})}else l({title:e.msg,icon:"none",duration:2e3})}))}))},getPhoneNumber(e){let t=this;if(t.isAgree){if("getPhoneNumber:ok"==e.detail.errMsg){let a=e.detail.code,c="";u({provider:"weixin",success:function(e){"login:ok"==e.errMsg&&(c=e.code);let u=n("pid")||"";""==u&&(u=0),o({title:"登录中"});let d={loginCode:c,phoneCode:a,pid:u};t.$apis.login.miniappLogin(d).then((e=>{if(i(),0==e.code){let e=n("prevUrl")||"/pages/user/index";e.indexOf("/cart/index")>0||e.indexOf("/user/index")>0?s({url:e}):r({url:e})}else l({title:e.msg,icon:"none",duration:2e3})}))}})}}else l({title:"请同意用户协议",icon:"none",duration:2e3})},wechatLogin(){this.isAgree?this.turnUrl("/pages/user/wechatLogin"):l({title:"请同意用户协议",icon:"none",duration:2e3})},goBack(){s({url:"/pages/index/index"})},turnUrl(e="",t=1){e&&"#"!=e&&(1==t&&c({url:e}),2==t&&s({url:e}),3==t&&r({url:e}))}}},[["render",function(e,t,a,l,n,o){const i=h,s=C,r=w(d("jp-verification-literalness"),D),u=w(d("uv-checkbox"),U),c=w(d("uv-checkbox-group"),H),p=L,$=I,N=w(d("uv-code"),S),j=w(d("uv-divider"),V),T=w(d("uv-icon"),A);return b(),g(i,{class:f(["content",n.theme]),style:_(n.backgroundStyle)},{default:m((()=>[v(i,{class:"wrap"},{default:m((()=>[v(i,{class:"status_bar",style:_({paddingTop:n.navHeight+"px"})},null,8,["style"]),v(i,{class:"login_top"},{default:m((()=>[v(i,null,{default:m((()=>[x("欢迎您，")])),_:1}),v(i,null,{default:m((()=>[x("亲爱的家人们！")])),_:1})])),_:1}),v(i,{class:"m_ctr"},{default:m((()=>[v(i,{class:"yuan_ctr"},{default:m((()=>[v(i,{class:"login_title_ctr"},{default:m((()=>[v(i,{class:f({on:0==n.curLogin,"":1==n.curLogin}),onClick:t[0]||(t[0]=e=>o.changeLogin(0))},{default:m((()=>[x("账号登录")])),_:1},8,["class"]),1==n.smsLogin?(b(),g(i,{key:0,class:"fg"})):y("",!0),1==n.smsLogin?(b(),g(i,{key:1,class:f({on:1==n.curLogin,"":0==n.curLogin}),onClick:t[1]||(t[1]=e=>o.changeLogin(1))},{default:m((()=>[x("验证码登录")])),_:1},8,["class"])):y("",!0)])),_:1}),0==n.curLogin?(b(),g($,{key:0,onSubmit:o.formSubmit},{default:m((()=>[v(i,{class:"input_title"},{default:m((()=>[x("账号：")])),_:1}),v(i,{class:"input_ctr"},{default:m((()=>[v(s,{name:"m_uid",placeholder:"请输入账号"})])),_:1}),v(i,{class:"input_title"},{default:m((()=>[x("密码：")])),_:1}),v(i,{class:"input_ctr"},{default:m((()=>[v(s,{name:"m_pwd",password:"true",placeholder:"请输入密码"})])),_:1}),v(i,{class:"input_title"},{default:m((()=>[x("验证码：")])),_:1}),v(i,{class:"input_ctr"},{default:m((()=>[v(i,{class:"get_code_ctr1"},{default:m((()=>[v(r,{ref:"captcha",contentHeight:35,contentWidth:100},null,512)])),_:1}),v(s,{name:"m_code",placeholder:"请输入验证码"})])),_:1}),v(i,{class:"agree_ctr",style:{"margin-top":"20rpx"}},{default:m((()=>[v(i,{class:"agree_ctt"},{default:m((()=>[v(c,{modelValue:n.checkboxValue,"onUpdate:modelValue":t[2]||(t[2]=e=>n.checkboxValue=e),shape:"circle",size:"14",activeColor:n.themeColor,onChange:o.checkAgree},{default:m((()=>[v(u,{name:"agree"})])),_:1},8,["modelValue","activeColor","onChange"]),v(i,null,{default:m((()=>[x("我已阅读并同意")])),_:1}),v(i,{onClick:t[3]||(t[3]=e=>o.turnUrl("/pages/article/agreement?type=user"))},{default:m((()=>[x("《用户协议》")])),_:1}),v(i,{onClick:t[4]||(t[4]=e=>o.turnUrl("/pages/article/agreement?type=privacy"))},{default:m((()=>[x("《隐私协议》")])),_:1})])),_:1})])),_:1}),v(p,{class:"login_btn",formType:"submit"},{default:m((()=>[x("立即登录")])),_:1})])),_:1},8,["onSubmit"])):y("",!0),1==n.curLogin?(b(),g($,{key:1,onSubmit:o.smsSubmit},{default:m((()=>[v(i,{class:"input_title"},{default:m((()=>[x("手机号：")])),_:1}),v(i,{class:"input_ctr"},{default:m((()=>[v(s,{name:"m_tel",type:"number",onInput:o.inputTel,placeholder:"请输入11位手机号"},null,8,["onInput"])])),_:1}),v(i,{class:"input_title"},{default:m((()=>[x("验证码：")])),_:1}),v(i,{class:"input_ctr"},{default:m((()=>[v(i,{class:"get_code_ctr"},{default:m((()=>[v(N,{seconds:n.seconds,onEnd:o.end,onStart:o.start,ref:"code",onChange:o.codeChange},null,8,["seconds","onEnd","onStart","onChange"]),v(i,{class:f(0==n.sending?"get_code_btn":"get_code_btn_on"),onClick:o.getCode},{default:m((()=>[x(k(n.tips),1)])),_:1},8,["class","onClick"])])),_:1}),v(s,{name:"m_code",type:"number",placeholder:"请输入验证码"})])),_:1}),v(i,{class:"agree_ctr",style:{"margin-top":"20rpx"}},{default:m((()=>[v(i,{class:"agree_ctt"},{default:m((()=>[v(c,{modelValue:n.checkboxValue,"onUpdate:modelValue":t[5]||(t[5]=e=>n.checkboxValue=e),shape:"circle",size:"14",activeColor:n.themeColor,onChange:o.checkAgree},{default:m((()=>[v(u,{name:"agree"})])),_:1},8,["modelValue","activeColor","onChange"]),v(i,null,{default:m((()=>[x("我已阅读并同意")])),_:1}),v(i,{onClick:t[6]||(t[6]=e=>o.turnUrl("/pages/article/agreement?type=user"))},{default:m((()=>[x("《用户协议》")])),_:1}),v(i,{onClick:t[7]||(t[7]=e=>o.turnUrl("/pages/article/agreement?type=privacy"))},{default:m((()=>[x("《隐私协议》")])),_:1})])),_:1})])),_:1}),v(p,{class:"login_btn",formType:"submit"},{default:m((()=>[x("立即登录")])),_:1})])),_:1},8,["onSubmit"])):y("",!0),v(i,{class:"agree_ctr"},{default:m((()=>[v(i,{class:"agree_ctt",style:{"font-size":"28rpx"},onClick:t[8]||(t[8]=e=>o.turnUrl("/pages/user/register",3))},{default:m((()=>[x(" 还没有账号，立即注册 ")])),_:1})])),_:1}),1==n.otherLogin?(b(),g(i,{key:2,class:"m_ctr"},{default:m((()=>[v(j,{text:"第三方登录"}),v(i,{class:"other_login_ctr"},{default:m((()=>[v(i,{class:"other_login_btn",onClick:t[9]||(t[9]=e=>o.wechatLogin())},{default:m((()=>[v(T,{name:"wechat","custom-prefix":"custom-icon",color:"#fff",size:"26"})])),_:1})])),_:1})])),_:1})):y("",!0)])),_:1})])),_:1})])),_:1})])),_:1},8,["class","style"])}],["__scopeId","data-v-b1404840"]]);export{N as default};
