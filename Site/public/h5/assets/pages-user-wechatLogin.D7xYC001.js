import{H as e,a,h as o,d as t,n,A as i,e as s,o as l,f as d,w as r,j as c,k as p,l as u,u as g}from"./index-CP7J3jEj.js";import{_ as h}from"./uv-loading-page.CzAcxD5Y.js";import{_ as f,r as m}from"./uni-app.es.CkShW-16.js";const w=f({data:()=>({loading:!0,code:""}),onLoad(e){let a=c(),o=this;if(o.loading=!1,Reflect.ownKeys(e).length>0&&e.hasOwnProperty("code")&&(o.code=e.code),""==a.globalData.siteInfo.mp_appid)i({title:"微信登录需要配置公众号",icon:"none"});else if(""==o.code){let e=document.location.href,o=encodeURIComponent(e.split("h5")[0]+"h5/pages/user/wechatLogin");window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+a.globalData.siteInfo.mp_appid+"&redirect_uri="+o+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"}else o.initData()},methods:{async initData(){let s=this;await s.$onLaunched;let l=e("pid")||"";""==l&&(l=0),a({title:"登录中"});let d={loginCode:s.code,pid:l};s.$apis.login.wechatLogin(d).then((a=>{if(o(),0==a.code){let a=e("prevUrl")||"";""!=a?(a="/"+a,a.indexOf("/cart/")>0||a.indexOf("/user/index")>0?t({url:a}):n({url:a})):t({url:"/pages/user/index"})}else i({title:a.msg,icon:"none",duration:2e3})}))}}},[["render",function(e,a,o,t,n,i){const c=m(s("uv-loading-page"),h),f=p;return l(),d(f,{class:"content"},{default:r((()=>[u(c,{loading:n.loading},null,8,["loading"]),n.loading?g("",!0):(l(),d(f,{key:0,class:"wrap"}))])),_:1})}]]);export{w as default};
