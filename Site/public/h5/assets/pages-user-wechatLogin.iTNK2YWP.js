import{A as e,E as a,a as o,h as t,d as n,r as i,e as s,f as d,w as l,j as r,k as c,o as p,l as g,u}from"./index-qqngRkUa.js";import{_ as h}from"./uv-loading-page.B-dgjlQB.js";import{_ as f,r as m}from"./uni-app.es.DMzxE133.js";const w=f({data:()=>({loading:!0,code:""}),onLoad(a){let o=r(),t=this;if(t.loading=!1,Reflect.ownKeys(a).length>0&&a.hasOwnProperty("code")&&(t.code=a.code),""==o.globalData.siteInfo.mp_appid)e({title:"微信登录需要配置公众号",icon:"none"});else if(""==t.code){let e=document.location.href,a=encodeURIComponent(e.split("h5")[0]+"h5/pages/user/wechatLogin");window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+o.globalData.siteInfo.mp_appid+"&redirect_uri="+a+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"}else t.initData()},methods:{async initData(){let s=this;await s.$onLaunched;let d=a("pid")||"";""==d&&(d=0),o({title:"登录中"});let l={loginCode:s.code,pid:d};s.$apis.login.wechatLogin(l).then((o=>{if(t(),0==o.code){let e=a("prevUrl")||"/pages/user/index";e.indexOf("/cart/")>0||e.indexOf("/user/index")>0?n({url:e}):i({url:e})}else e({title:o.msg,icon:"none",duration:2e3})}))}}},[["render",function(e,a,o,t,n,i){const r=m(s("uv-loading-page"),h),f=c;return p(),d(f,{class:"content"},{default:l((()=>[g(r,{loading:n.loading},null,8,["loading"]),n.loading?u("",!0):(p(),d(f,{key:0,class:"wrap"}))])),_:1})}]]);export{w as default};
