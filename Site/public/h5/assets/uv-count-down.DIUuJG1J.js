var t,e;import{E as i,G as s,o as a,f as m,w as n,Q as o,l as r,q as h,v as u,C as l,R as c,k as d}from"./index-CGszr9qB.js";import{_ as T}from"./uni-app.es.CLj63pkI.js";const f={props:{time:{type:[String,Number],default:0},format:{type:String,default:"HH:mm:ss"},autoStart:{type:Boolean,default:!0},millisecond:{type:Boolean,default:!1},...null==(e=null==(t=uni.$uv)?void 0:t.props)?void 0:e.countDown}};function p(t,e=2){let i=`${t}`;for(;i.length<e;)i=`0${i}`;return i}function g(t){return{days:Math.floor(t/864e5),hours:Math.floor(t%864e5/36e5),minutes:Math.floor(t%36e5/6e4),seconds:Math.floor(t%6e4/1e3),milliseconds:Math.floor(t%1e3)}}const v=T({name:"uv-count-down",mixins:[i,s,f],data:()=>({timer:null,timeData:g(0),formattedTime:"0",runing:!1,endTime:0,remainTime:0}),watch:{time(t){this.reset()}},mounted(){this.init()},methods:{init(){this.reset()},start(){this.runing||(this.runing=!0,this.endTime=Date.now()+this.remainTime,this.toTick())},toTick(){this.millisecond?this.microTick():this.macroTick()},macroTick(){this.clearTimeout(),this.timer=setTimeout((()=>{const t=this.getRemainTime();var e,i;e=t,i=this.remainTime,(Math.floor(e/1e3)!==Math.floor(i/1e3)||0===t)&&this.setRemainTime(t),0!==this.remainTime&&this.macroTick()}),30)},microTick(){this.clearTimeout(),this.timer=setTimeout((()=>{this.setRemainTime(this.getRemainTime()),0!==this.remainTime&&this.microTick()}),50)},getRemainTime(){return Math.max(this.endTime-Date.now(),0)},setRemainTime(t){this.remainTime=t;const e=g(t);this.$emit("change",e),this.formattedTime=function(t,e){let{days:i,hours:s,minutes:a,seconds:m,milliseconds:n}=e;return-1===t.indexOf("DD")?s+=24*i:t=t.replace("DD",p(i)),-1===t.indexOf("HH")?a+=60*s:t=t.replace("HH",p(s)),-1===t.indexOf("mm")?m+=60*a:t=t.replace("mm",p(a)),-1===t.indexOf("ss")?n+=1e3*m:t=t.replace("ss",p(m)),t.replace("SSS",p(n,3))}(this.format,e),t<=0&&(this.pause(),this.$emit("finish"))},reset(){this.pause(),this.remainTime=this.time,this.setRemainTime(this.remainTime),this.autoStart&&this.start()},pause(){this.runing=!1,this.clearTimeout()},clearTimeout(){clearTimeout(this.timer),this.timer=null}},unmounted(){this.clearTimeout()}},[["render",function(t,e,i,s,T,f){const p=c,g=d;return a(),m(g,{class:"uv-count-down",style:l([t.$uv.addStyle(t.customStyle)])},{default:n((()=>[o(t.$slots,"default",{},(()=>[r(p,{class:"uv-count-down__text"},{default:n((()=>[h(u(T.formattedTime),1)])),_:1})]),!0)])),_:3},8,["style"])}],["__scopeId","data-v-5f5e474a"]]);export{v as _};
